<!DOCTYPE html><html><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="preload" href="/component---src-layouts-index-js-c56dd00f07d25fed4a16.js" as="script"/><link rel="preload" href="/component---src-templates-blog-post-js-2135bb467038b8e63291.js" as="script"/><link rel="preload" href="/path---leveling-up-your-dotnet-testing-2f15bb2a84f12330efbf.js" as="script"/><link rel="preload" href="/app-fc0aa8571a96e457f8e7.js" as="script"/><link rel="preload" href="/commons-052854b14b2d9cebb713.js" as="script"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><title data-react-helmet="true">Leveling Up Your .Net Testing Patterns - Part I | nance.io</title><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:1.2rem;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#007acc;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}</style><style id="gatsby-inlined-css">code[class*=language-],pre[class*=language-]{color:#bfc7d5;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;background:#292d3e}:not(pre)>code[class*=language-]{color:#292d3e;background-color:rgba(191,199,213,.53333);padding:.1em .3em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#697098}.token.class-name,.token.punctuation{color:#82aaff}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#ff5572}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#ffcb6b}.token.constant,.token.property,.token.symbol{color:#c3e88d}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#bf79db}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#c3e88d}.token.entity,.token.operator,.token.url{color:#80cbc4}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:#66d9ef}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100.50d27986.woff2) format("woff2"),url(/static/montserrat-latin-100.5e334eff.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic.8c070533.woff2) format("woff2"),url(/static/montserrat-latin-100italic.03e19243.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200.4343d3d9.woff2) format("woff2"),url(/static/montserrat-latin-200.f2022ecd.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic.116c4c4b.woff2) format("woff2"),url(/static/montserrat-latin-200italic.89614a60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300.d2ad295b.woff2) format("woff2"),url(/static/montserrat-latin-300.3a371ee0.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic.f6b6bf24.woff2) format("woff2"),url(/static/montserrat-latin-300italic.16521668.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400.240a8444.woff2) format("woff2"),url(/static/montserrat-latin-400.b20cc131.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic.86172bb8.woff2) format("woff2"),url(/static/montserrat-latin-400italic.9405e787.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500.fb8d6b71.woff2) format("woff2"),url(/static/montserrat-latin-500.50825d47.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic.c0a555a4.woff2) format("woff2"),url(/static/montserrat-latin-500italic.635de59c.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600.d5615136.woff2) format("woff2"),url(/static/montserrat-latin-600.f300da4f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic.10f29d13.woff2) format("woff2"),url(/static/montserrat-latin-600italic.2bc37d86.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700.7d77e1f0.woff2) format("woff2"),url(/static/montserrat-latin-700.81826529.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic.1dd2b53f.woff2) format("woff2"),url(/static/montserrat-latin-700italic.c162d257.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800.d4e7bf86.woff2) format("woff2"),url(/static/montserrat-latin-800.895aadbf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic.fc0cbe44.woff2) format("woff2"),url(/static/montserrat-latin-800italic.b3362875.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900.c8bdd772.woff2) format("woff2"),url(/static/montserrat-latin-900.1b99ef78.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic.cb72c1f9.woff2) format("woff2"),url(/static/montserrat-latin-900italic.b78bb9f8.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300.f015f1e9.woff2) format("woff2"),url(/static/merriweather-latin-300.92dfe81b.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic.7fd86b32.woff2) format("woff2"),url(/static/merriweather-latin-300italic.878b76f5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400.12dbf4c0.woff2) format("woff2"),url(/static/merriweather-latin-400.1fffad22.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic.1e0d3e81.woff2) format("woff2"),url(/static/merriweather-latin-400italic.de18d4c4.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700.dc8fec81.woff2) format("woff2"),url(/static/merriweather-latin-700.d7d2ed8e.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic.b7b7e5da.woff2) format("woff2"),url(/static/merriweather-latin-700italic.6210a5fc.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900.43f870d5.woff2) format("woff2"),url(/static/merriweather-latin-900.8f3806df.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic.168c1ab2.woff2) format("woff2"),url(/static/merriweather-latin-900italic.ae7778f0.woff) format("woff")}</style></head><body><div id="___gatsby"><div style="max-width:42rem;margin-left:auto;margin-right:auto;padding:2.625rem 1.3125rem;" data-reactroot="" data-reactid="1" data-react-checksum="920230155"><h3 style="font-family:Montserrat, sans-serif;margin-top:0;margin-bottom:-1.75rem;" data-reactid="2"><a style="box-shadow:none;text-decoration:none;color:inherit;" href="/" data-reactid="3">nance.io</a></h3><div data-reactid="4"><!-- react-empty: 5 --><h1 data-reactid="6">Leveling Up Your .Net Testing Patterns - Part I</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem;margin-top:-1.75rem;" data-reactid="7">April 08, 2018</p><div data-reactid="8"><p>This is a two part blog post in which I will provide guidelines, opinions and tools that you can use to improve your .Net testing experience.
In part 1, I will first introduce a proposed solution structure, then I will talk about the importance and challenges of making your tests
idempotent and finally I’ll show you how to use model factories to generate fake data for your tests.</p>
<p>I am generally a fan of frameworks that reduce decision making by providing well thought out, sane default recommendations or opinions
about how things should be done. However, most .Net frameworks and libraries are predominantly un-opinionated which is good and bad.
The good part about it is that it provides you with extreme flexibility. The bad part is that it provides little to no guidance
around a good path for doing things.</p>
<p>I would like to point out that ASP.Net Core is much more opinionated than most .Net frameworks and does a really excellent job of
providing out-of-the-box tools like
<a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/dependency-injection">Dependency Injection</a>,
<a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration/options">Configuration</a>,
<a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/environments">Environment loading</a> and
<a href="https://docs.microsoft.com/en-us/aspnet/core/security/authentication/identity">Identity Management</a>.</p>
<h2>Project Structure</h2>
<p>The first is a proposal for project structure. Here is a sample directory tree that I use for all new projects.
The <code class="language-text">src</code> directory represents the actual application or class library projects that make up the Systems Under Test (SUT).
The <code class="language-text">test</code> directory contains all of the test projects that will validate the <code class="language-text">src</code> projects.</p>
<div class="gatsby-highlight">
      <pre class="language-text"><code class="language-text">Solution/
├── src/
│   └── Project1/
│       ├── ...
│       └── Project1.csproj
└── tests/
    └── Project1Tests/
        ├── Acceptance/
        ├── Factories/
        ├── Integration/
        ├── Stubs/
        ├── Unit/
        ├── Utilities/
        ├── ...
        └── Project1Tests.csproj</code></pre>
      </div>
<h3>Project : TestProject Ratio</h3>
<p>I recommend a 1:1 relationship between <code class="language-text">src</code> projects and <code class="language-text">tests</code> projects.
This makes it very clear where tests should live for a specific piece of functionality.
It also mitigates the risk that a test project could be running different assembly versions than what the application actually runs.
If a test project references several different application projects, and those projects reference a common dependency at different
versions it will have to generate
<a href="https://docs.microsoft.com/en-us/dotnet/framework/configure-apps/redirect-assembly-versions">assembly redirects</a>
to a compatible dependency version.</p>
<h3>Test Project Structure</h3>
<p>Within each test project, tests can be divided into 3 categories:</p>
<ul>
<li><strong>Unit</strong>: Tests that target individual method functionality in isolation</li>
<li><strong>Integration</strong>: Tests that target multiple application layers</li>
<li><strong>Acceptance</strong>: End-to-end tests, commonly using the ASP.Net Core <code class="language-text">TestServer</code> class</li>
</ul>
<p>Tests generally require additional functionality to construct the scenarios to be tested.
These fall into 3 categories as well:</p>
<ul>
<li><strong>Factories</strong>: Classes to generate fake data</li>
<li><strong>Stubs</strong>: When mocks aren’t enough you may need to stub functionality. However, mocks should meet most requirements.</li>
<li><strong>Utilities</strong>: Classes that provide common functionality for debugging, setup, or validation.</li>
</ul>
<h2>Tests Should be Idempotent</h2>
<p>You should strive to make your tests idempotent, that is they should be able to run and pass anytime.
This means you should avoid using test framework decorators that prevent tests from running such as NUnit’s
<code class="language-text">[Explicit]</code> and xUnit’s <code class="language-text">[Fact(Skip=&quot;...&quot;)]</code>.</p>
<p>Often times developers will write tests to verify the functionality of a module at a particular time but fail to
write the test in such a way that it can be run consistently in the future.
I have observed four main causes of this:</p>
<ol>
<li><strong>The test depends on some external state that is difficult to construct</strong></li>
</ol>
<p>In some cases these challenges are very real. But I encourage you to apply the initial investment
so that your tests can protect you against future changes. In my experience, once these test are excluded from the
test runs, they are rarely revisited. This means that all of the value gained from that test is realized during the
micro-development cycle in which it was written and afterwards provides no value to the project. With some extra
effort you will continue to reap benefits from that test for as long as that functionality exists.</p>
<ol start="2">
<li><strong>The test has external side effects</strong></li>
</ol>
<p>Generally, with a little effort and some clean up code—in xUnit this is done via <code class="language-text">Dispose()</code>—this can be easily handled in most cases.
In part 2 of this blog post, I’ll demonstrate how to make your tests transactional so that you don’t even have to think
about this issue.</p>
<ol start="3">
<li><strong>The test is flaky</strong></li>
</ol>
<p>A flaky test is one that fails intermittently making the source of the error difficult to track down or reproduce.
Flaky tests are usually a sign that something else is going on and it may actually be a bug in your application or library.
Often times a test that fails intermittently is a sign that there is some boundary condition the test creates that is not
properly handled by the application. It could also mean that the test is not correctly testing the piece of functionality it
was intended to test and should be re-evaluated. Later on in this post I’ll demonstrate one way to deal with intermittently
failing tests caused by input data.</p>
<ol start="4">
<li><strong>The test is long running</strong></li>
</ol>
<p>Long running tests can be a pain because you don’t want to run them every time locally if you don’t expect the behavior to
be affected. However, there are alternatives to labelling them as explicit. You can also decorate your xUnit tests with
<code class="language-text">Trait</code>s and then filter by those. For example, if you want to skip long running tests you can label them as
<code class="language-text">[Trait(&quot;Exclude&quot;,&quot;Local&quot;)]</code>. Then you can run all tests that haven’t been excluded locally.</p>
<div class="gatsby-highlight">
      <pre class="language-text"><code class="language-text">dotnet test --filter Exclude!=Local</code></pre>
      </div>
<p>You can also filter your tests by the domain you’re working on. By default the test runner will filter by the FullyQualifiedName.
So, if you’re working on several layers of your stack that are all namespaced under <code class="language-text">Articles</code>, you can just:</p>
<div class="gatsby-highlight">
      <pre class="language-text"><code class="language-text">dotnet test --filter Articles</code></pre>
      </div>
<h2>Factories</h2>
<p>Factories are an excellent way to reduce the boilerplate for individual tests.
If you’re not familiar with factories, they are a <a href="https://en.wikipedia.org/wiki/Creational_pattern">creational pattern</a>
that abstract the instantiation process of a type.
The simplest form a factory can take is:</p>
<div class="gatsby-highlight">
      <pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BeerFactory</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> Beer <span class="token function">Create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">new</span> <span class="token class-name">Beer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>The most common use of Factories is to provide a mechanism for the instantiation of different implementations of an
interface that is dependent upon some runtime condition. Often times this takes the form of a switch statement:</p>
<div class="gatsby-highlight">
      <pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BeerFactory</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> IBeer <span class="token function">Create</span><span class="token punctuation">(</span>BeerType beerType<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">switch</span><span class="token punctuation">(</span>beerType<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">case</span> BeerType<span class="token punctuation">.</span>Ale<span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Ale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> BeerType<span class="token punctuation">.</span>Stout<span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Stout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> BeerType<span class="token punctuation">.</span>Lager<span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Lager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>However, we’re going to discuss an entirely different use case for Factories: test model instantiation.
We will use factories in our tests to:</p>
<ul>
<li>Isolate model creation</li>
<li>Generate fake data and add entropy to our tests</li>
</ul>
<p>The idea of using factories for test data is by no means a new concept and is ubiquitous in other communities.
However, I rarely see their use in .Net projects so, I wanted to write this post to try and make the concept
more relatable and concrete for .Net developers who may not be familiar with this practice.</p>
<p>To start let’s consider the following test case that is intended to compute the cost of an item.</p>
<div class="gatsby-highlight">
      <pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">async</span> Task <span class="token function">GetPrice_Returns_The_Expected_Item_Price</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// arrange</span>
    <span class="token keyword">var</span> item <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShoppingCartItem</span> <span class="token punctuation">{</span>
        Name <span class="token operator">=</span> <span class="token string">"Beer"</span><span class="token punctuation">,</span>
        UnitCost <span class="token operator">=</span> <span class="token number">5.00</span>m<span class="token punctuation">,</span>
        Count <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span>
        CostType <span class="token operator">=</span> CostType<span class="token punctuation">.</span>Count
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> expectedCost <span class="token operator">=</span> item<span class="token punctuation">.</span>UnitCost <span class="token operator">*</span> item<span class="token punctuation">.</span>Count<span class="token punctuation">;</span>

    <span class="token keyword">var</span> itemCostCalculator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ItemCostCalculator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// act</span>
    <span class="token keyword">var</span> actualCost <span class="token operator">=</span> itemCostCalculator<span class="token punctuation">.</span><span class="token function">GetTotalPrice</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// assert</span>
    Assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>expectedCost<span class="token punctuation">,</span> actualCost<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>This test seems fine, but it’s very static. Every time it runs it will do the same thing without variation
and doesn’t flex the system very much. Alternatively, we could generate random values and manually construct
our instance:</p>
<div class="gatsby-highlight">
      <pre class="language-csharp"><code class="language-csharp"><span class="token keyword">var</span> item <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShoppingCartItem</span> <span class="token punctuation">{</span>
    Name <span class="token operator">=</span> Guid<span class="token punctuation">.</span><span class="token function">NewGuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token string">"N"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    UnitCost <span class="token operator">=</span> <span class="token function">GetRandomDecimal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Count <span class="token operator">=</span> <span class="token function">GetRandomInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    CostType <span class="token operator">=</span> <span class="token generic-method function">GetRandomEnum<span class="token punctuation">&lt;</span>CostType<span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
      </div>
<p>This is better because we alter the inputs to our system under test (SUT) on every test run.
However, the problem with this is that you will have to write code that performs the generation
of these random values and it will not be reproducible in the event of a failure
(i.e. using <code class="language-text">Guid</code> for strings is not going to be reproducible).</p>
<p>Luckily, others have already done this kind of work for us. Some great projects for .Net are:</p>
<ul>
<li><a href="https://github.com/bchavez/Bogus">Bogus</a></li>
<li><a href="https://github.com/FakeItEasy/FakeItEasy">FakeItEasy</a></li>
<li><a href="https://github.com/jonwingfield/Faker.Net">Faker.Net</a></li>
<li><a href="https://github.com/nbuilder/nbuilder">NBuilder</a></li>
</ul>
<p>I’ll be using Bogus, but you can do the same kinds of things with any of the above packages.</p>
<p>So, to begin let’s see an example of how we can create a factory for our <code class="language-text">ShoppingCartItem</code>:</p>
<div class="gatsby-highlight">
      <pre class="language-csharp"><code class="language-csharp"><span class="token keyword">using</span> Bogus<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ShoppingCartItemFactory</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> List<span class="token operator">&lt;</span>ShoppingCartItem<span class="token operator">></span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">new</span> <span class="token class-name">Faker</span><span class="token operator">&lt;</span>ShoppingCartItem<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">RuleFor</span><span class="token punctuation">(</span>i <span class="token operator">=</span><span class="token operator">></span> i<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> f<span class="token punctuation">.</span>Commerce<span class="token punctuation">.</span><span class="token function">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">RuleFor</span><span class="token punctuation">(</span>i <span class="token operator">=</span><span class="token operator">></span> i<span class="token punctuation">.</span>UnitCost<span class="token punctuation">,</span> f <span class="token operator">=</span><span class="token operator">></span> f<span class="token punctuation">.</span>Random<span class="token punctuation">.</span><span class="token function">Decimal</span><span class="token punctuation">(</span>min<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">RuleFor</span><span class="token punctuation">(</span>i <span class="token operator">=</span><span class="token operator">></span> i<span class="token punctuation">.</span>Count<span class="token punctuation">,</span> f <span class="token operator">=</span><span class="token operator">></span> f<span class="token punctuation">.</span>Random<span class="token punctuation">.</span><span class="token function">Number</span><span class="token punctuation">(</span>min<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">RuleFor</span><span class="token punctuation">(</span>i <span class="token operator">=</span><span class="token operator">></span> i<span class="token punctuation">.</span>Weight<span class="token punctuation">,</span> f <span class="token operator">=</span><span class="token operator">></span> f<span class="token punctuation">.</span>Random<span class="token punctuation">.</span><span class="token function">Decimal</span><span class="token punctuation">(</span>min<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">RuleFor</span><span class="token punctuation">(</span>i <span class="token operator">=</span><span class="token operator">></span> i<span class="token punctuation">.</span>CostType<span class="token punctuation">,</span> f <span class="token operator">=</span><span class="token operator">></span> f<span class="token punctuation">.</span>Random<span class="token punctuation">.</span><span class="token generic-method function">PickRandom<span class="token punctuation">&lt;</span>ItemType<span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Generate</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>Then in our tests we can use our factory:</p>
<div class="gatsby-highlight">
      <pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">async</span> Task <span class="token function">GetPrice_Returns_The_Expected_Item_Price</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// arrange</span>
    <span class="token keyword">var</span> item <span class="token operator">=</span> ShoppingCartItemFactory<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> units <span class="token operator">=</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>ItemType <span class="token operator">==</span> ItemType<span class="token punctuation">.</span>Weighed<span class="token punctuation">)</span>
        <span class="token operator">?</span> item<span class="token punctuation">.</span>Weight
        <span class="token punctuation">:</span> item<span class="token punctuation">.</span>Count<span class="token punctuation">;</span>

    <span class="token keyword">var</span> expectedCost <span class="token operator">=</span> units <span class="token operator">*</span> item<span class="token punctuation">.</span>UnitCost<span class="token punctuation">;</span>

    <span class="token keyword">var</span> itemCostCalculator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ItemCostCalculator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// act</span>
    <span class="token keyword">var</span> actualCost <span class="token operator">=</span> itemCostCalculator<span class="token punctuation">.</span><span class="token function">GetTotalPrice</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// assert</span>
    Assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>expectedCost<span class="token punctuation">,</span> actualCost<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>So, we’re now generating fake data that may even resemble some of the actual inputs our system will receive.
And our test is a little more pleasant to read.
But, what kind of scenarios exist that fake data can actually help us catch?
Consider the following requirement:</p>
<blockquote>
<p>The total cost is the unit cost multiplied by the count if the unit is priced by count.
However if the unit is priced by weight, then the total cost is the unit cost multiplied by the
weight of the unit.</p>
</blockquote>
<p>Okay so now consider a faulty <code class="language-text">ItemCostCalculator</code> implementation that does not take item type
into consideration and assumes all items are priced by count:</p>
<div class="gatsby-highlight">
      <pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ItemCostCalculator</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">decimal</span> <span class="token function">GetTotalPrice</span><span class="token punctuation">(</span>ShoppingCartItem item<span class="token punctuation">)</span>
        <span class="token operator">=</span><span class="token operator">></span> item<span class="token punctuation">.</span>Count <span class="token operator">*</span> item<span class="token punctuation">.</span>UnitCost<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>Our original test would have passed every time because we only ever tested the count condition.
However, we will get intermittent failures of our new test, because we expect the calculator to correctly
compute cost based on <code class="language-text">ItemType</code>. We can now fix our <code class="language-text">ItemCostCalculator</code> and the test will pass every time.</p>
<p>I would like to quickly point out that in this example you <strong>should</strong> write
multiple tests that test both conditions separately. However, the regular
use of fake data generation in tests helps us to catch mistakes like this one.</p>
<h3>Reproducing Flaky Tests</h3>
<p>One challenge with using generated data is that it can be difficult to reproduce failures locally.
So, the tests may fail during CI, but if you can’t reproduce them consistently then it can be difficult to
track down root cause. I was recently working with <a href="https://github.com/rtablada">Ryan Tablada</a> on this
exact issue and the solution he proposed was to use the same seed for all data generation tests and log that seed
at the beginning of the test. This seed can be overridden by an environment variable, allowing us to re-run the
tests with the same fake data.</p>
<p>Each test can inherit from a base test fixture that sets the seed in its
<a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/static-constructors">static constructor</a>.
The CLR ensures that static constructors are only called once per process making this operation thread safe.
Since it is only called once, all tests will use the same seed and you will only log the seed once at the beginning
of the run.</p>
<p>Prior to .Net Core static constructors would be invoked per AppDomain rather than per process.
However, the AppDomain no longer exists so this is a non-issue for .Net Core users.
If you’re using an older testing framework (e.g. <a href="http://nunit.org/docs/2.6.3/assemblyIsolation.html">NUnit</a>)
that provides AppDomain isolation between individual tests, this exact solution will probably not work for you.
However, most testing frameworks provide a way to share state across all tests, so using their built-in APIs should work.</p>
<div class="gatsby-highlight">
      <pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ItemCostCalculator_Tests</span> <span class="token punctuation">:</span> TestFixture <span class="token punctuation">{</span> <span class="token comment">/*...*/</span> <span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestFixture</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> Seed<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token function">TestFixture</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">var</span> randTick <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span>Ticks <span class="token operator">&amp;</span> <span class="token number">0x0000FFFF</span><span class="token punctuation">;</span>
        Seed <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token function">TryParse</span><span class="token punctuation">(</span>Environment<span class="token punctuation">.</span><span class="token function">GetEnvironmentVariable</span><span class="token punctuation">(</span><span class="token string">"TEST_SEED"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token keyword">var</span> seedOverride<span class="token punctuation">)</span>
                <span class="token operator">?</span> seedOverride
                <span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>randTick<span class="token punctuation">;</span>

        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>$<span class="token string">"Using test seed: {_seed}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>Now in the instance constructor, we assign the seed back to the Bogus randomizer.
This will ensure that each individual test runs with the correct seed.</p>
<div class="gatsby-highlight">
      <pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestFixture</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> Seed<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token function">TestFixture</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">var</span> randTick <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span>Ticks <span class="token operator">&amp;</span> <span class="token number">0x0000FFFF</span><span class="token punctuation">;</span>
        Seed <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token function">TryParse</span><span class="token punctuation">(</span>Environment<span class="token punctuation">.</span><span class="token function">GetEnvironmentVariable</span><span class="token punctuation">(</span><span class="token string">"TEST_SEED"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token keyword">var</span> seedOverride<span class="token punctuation">)</span>
                <span class="token operator">?</span> seedOverride
                <span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>randTick<span class="token punctuation">;</span>

        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>$<span class="token string">"Using test seed: {Seed}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token function">TestFixture</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Randomizer<span class="token punctuation">.</span>Seed <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span>Seed<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>By assigning the seed to the Bogus <code class="language-text">Randomizer</code> in the instance constructor we can ensure that
each individual test within a test run will use the same seed.
So, when we get the intermittent failure described above, we should be able to go to our test log
and see something like:</p>
<div class="gatsby-highlight">
      <pre class="language-text"><code class="language-text">Using test seed: 73202934</code></pre>
      </div>
<p>We can then pull the branch locally and set the environment variable:</p>
<p>CMD:</p>
<div class="gatsby-highlight">
      <pre class="language-text"><code class="language-text">setx TEST_SEED 73202934</code></pre>
      </div>
<p>Bash:</p>
<div class="gatsby-highlight">
      <pre class="language-text"><code class="language-text">export TEST_SEED=73202934</code></pre>
      </div>
<p>Now, when we re-run the test, the model factories will use the same seeds and generate
the same fake data causing the test to fail again.</p>
<h2>Summary</h2>
<p>Using test model factories to generate fake data for our unit tests is a good way to increase the coverage
of our tests across multiple runs while also providing the added benefit of making our tests more legible.
By adding randomness to our tests we can discover issues that may never be discovered through the use of
static test data.</p>
<h2>What’s Next</h2>
<p>In my next post on .Net testing, I will show some ways we can make tests with side-effects idempotent via
test cleanup methods and transactional integration testing.</p></div><hr style="margin-bottom:1.75rem;" data-reactid="9"/><div style="display:flex;margin-bottom:4.375rem;" data-reactid="10"><img src="/static/profile-pic.4eeca420.png" alt="jaredcnance" style="margin-right:0.875rem;margin-bottom:0;margin-top:1.575rem;width:3.5rem;height:3.5rem;" data-reactid="11"/><p data-reactid="12"><!-- react-text: 13 -->My name is <!-- /react-text --><strong data-reactid="14">Jared Nance</strong><!-- react-text: 15 -->, I live and work in Kansas City. I enjoy building things and sharing what I learn along the way.<!-- /react-text --><!-- react-text: 16 --> <!-- /react-text --><!-- react-text: 17 -->You can follow me on<!-- /react-text --><!-- react-text: 18 --> <!-- /react-text --><a href="https://twitter.com/jaredcnance" data-reactid="19">Twitter</a><!-- react-text: 20 --> or<!-- /react-text --><!-- react-text: 21 --> <!-- /react-text --><a href="https://github.com/jaredcnance" data-reactid="22">GitHub</a></p></div><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0;" data-reactid="23"><li data-reactid="24"><a rel="prev" href="/dotnet-performance-optimization/" data-reactid="25"><!-- react-text: 26 -->← <!-- /react-text --><!-- react-text: 27 -->A Strategy for the Measurement and Optimization of .NET Application Performance<!-- /react-text --></a></li></ul></div><span style="display:block;clear:both;" data-reactid="28"> </span></div></div><script id="webpack-manifest">/*<![CDATA[*/window.webpackManifest={"231608221292675":"app-fc0aa8571a96e457f8e7.js","99219681209289":"component---node-modules-gatsby-plugin-offline-app-shell-js-5c4c5a0f7af9dc69d6d7.js","107818501498521":"component---src-templates-blog-post-js-2135bb467038b8e63291.js","162898551421021":"component---src-pages-404-js-4503918ea3a16cfcdb75.js","35783957827783":"component---src-pages-index-js-60fad39aa6d61a87ce0f.js","60335399758886":"path----557518bd178906f8d58a.js","210333531512890":"path---offline-plugin-app-shell-fallback-a0e39f21c11f6a62c5ab.js","163616910017581":"path---leveling-up-your-dotnet-testing-2f15bb2a84f12330efbf.js","130323105709194":"path---dotnet-performance-optimization-f7a37ffc90ec2ef7dac5.js","106575918426696":"path---logging-in-azure-functions-6b53a26499377d5c601f.js","68384136547871":"path---dotnet-core-dependency-injection-4afa01cdc240060498f3.js","180578961852115":"path---typescript-vs-javascript-daa51c41f19c7f254497.js","47572940128521":"path---hangfire-tasks-in-dotnet-core-1a9079460424abfdc46e.js","254022195166212":"path---404-a0e39f21c11f6a62c5ab.js","142629428675168":"path---index-1103b75e83d508301da1.js","178698757827068":"path---404-html-a0e39f21c11f6a62c5ab.js","114276838955818":"component---src-layouts-index-js-c56dd00f07d25fed4a16.js"}/*]]>*/</script><script>
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-116668380-1', 'auto');
      }
      </script><script>/*<![CDATA[*/!function(e,t,r){function n(){for(;d[0]&&"loaded"==d[0][f];)c=d.shift(),c[o]=!i.parentNode.insertBefore(c,i)}for(var s,a,c,d=[],i=e.scripts[0],o="onreadystatechange",f="readyState";s=r.shift();)a=e.createElement(t),"async"in i?(a.async=!1,e.head.appendChild(a)):i[f]?(d.push(a),a[o]=n):e.write("<"+t+' src="'+s+'" defer></'+t+">"),a.src=s}(document,"script",["/commons-052854b14b2d9cebb713.js","/app-fc0aa8571a96e457f8e7.js","/path---leveling-up-your-dotnet-testing-2f15bb2a84f12330efbf.js","/component---src-templates-blog-post-js-2135bb467038b8e63291.js","/component---src-layouts-index-js-c56dd00f07d25fed4a16.js"])/*]]>*/</script></body></html>