<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[nance.io]]></title><description><![CDATA[A blog about programming things.]]></description><link>https://jaredcnance.github.io/</link><generator>RSS for Node</generator><lastBuildDate>Sun, 08 Apr 2018 21:48:00 GMT</lastBuildDate><item><title><![CDATA[Leveling Up Your .Net Testing Patterns - Part I]]></title><description><![CDATA[This is a two part blog post in which I will provide guidelines, opinions and tools that you can use to improve your .Net testing experience…]]></description><link>https://jaredcnance.github.io//leveling-up-your-dotnet-testing/</link><guid isPermaLink="false">https://jaredcnance.github.io//leveling-up-your-dotnet-testing/</guid><pubDate>Sun, 08 Apr 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;This is a two part blog post in which I will provide guidelines, opinions and tools that you can use to improve your .Net testing experience.
In part 1, I will first introduce a proposed solution structure, then I will talk about the importance and challenges of making your tests
idempotent and finally I’ll show you how to use model factories to generate fake data for your tests.&lt;/p&gt;
&lt;p&gt;I am generally a fan of frameworks that reduce decision making by providing well thought out, sane default recommendations or opinions
about how things should be done. However, most .Net frameworks and libraries are predominantly un-opinionated which is good and bad.
The good part about it is that it provides you with extreme flexibility. The bad part is that it provides little to no guidance
around a good path for doing things.&lt;/p&gt;
&lt;p&gt;I would like to point out that ASP.Net Core is much more opinionated than most .Net frameworks and does a really excellent job of
providing out-of-the-box tools like
&lt;a href=&quot;https://docs.microsoft.com/en-us/aspnet/core/fundamentals/dependency-injection&quot;&gt;Dependency Injection&lt;/a&gt;,
&lt;a href=&quot;https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration/options&quot;&gt;Configuration&lt;/a&gt;,
&lt;a href=&quot;https://docs.microsoft.com/en-us/aspnet/core/fundamentals/environments&quot;&gt;Environment loading&lt;/a&gt; and
&lt;a href=&quot;https://docs.microsoft.com/en-us/aspnet/core/security/authentication/identity&quot;&gt;Identity Management&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Project Structure&lt;/h2&gt;
&lt;p&gt;The first is a proposal for project structure. Here is a sample directory tree that I use for all new projects.
The &lt;code class=&quot;language-text&quot;&gt;src&lt;/code&gt; directory represents the actual application or class library projects that make up the Systems Under Test (SUT).
The &lt;code class=&quot;language-text&quot;&gt;test&lt;/code&gt; directory contains all of the test projects that will validate the &lt;code class=&quot;language-text&quot;&gt;src&lt;/code&gt; projects.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Solution/
├── src/
│   └── Project1/
│       ├── ...
│       └── Project1.csproj
└── tests/
    └── Project1Tests/
        ├── Acceptance/
        ├── Factories/
        ├── Integration/
        ├── Stubs/
        ├── Unit/
        ├── Utilities/
        ├── ...
        └── Project1Tests.csproj&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h3&gt;Project : TestProject Ratio&lt;/h3&gt;
&lt;p&gt;I recommend a 1:1 relationship between &lt;code class=&quot;language-text&quot;&gt;src&lt;/code&gt; projects and &lt;code class=&quot;language-text&quot;&gt;tests&lt;/code&gt; projects.
This makes it very clear where tests should live for a specific piece of functionality.
It also mitigates the risk that a test project could be running different assembly versions than what the application actually runs.
If a test project references several different application projects, and those projects reference a common dependency at different
versions it will have to generate
&lt;a href=&quot;https://docs.microsoft.com/en-us/dotnet/framework/configure-apps/redirect-assembly-versions&quot;&gt;assembly redirects&lt;/a&gt;
to a compatible dependency version.&lt;/p&gt;
&lt;h3&gt;Test Project Structure&lt;/h3&gt;
&lt;p&gt;Within each test project, tests can be divided into 3 categories:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Unit&lt;/strong&gt;: Tests that target individual method functionality in isolation&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Integration&lt;/strong&gt;: Tests that target multiple application layers&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Acceptance&lt;/strong&gt;: End-to-end tests, commonly using the ASP.Net Core &lt;code class=&quot;language-text&quot;&gt;TestServer&lt;/code&gt; class&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Tests generally require additional functionality to construct the scenarios to be tested.
These fall into 3 categories as well:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Factories&lt;/strong&gt;: Classes to generate fake data&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Stubs&lt;/strong&gt;: When mocks aren’t enough you may need to stub functionality. However, mocks should meet most requirements.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Utilities&lt;/strong&gt;: Classes that provide common functionality for debugging, setup, or validation.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Tests Should be Idempotent&lt;/h2&gt;
&lt;p&gt;You should strive to make your tests idempotent, that is they should be able to run and pass anytime.
This means you should avoid using test framework decorators that prevent tests from running such as NUnit’s
&lt;code class=&quot;language-text&quot;&gt;[Explicit]&lt;/code&gt; and xUnit’s &lt;code class=&quot;language-text&quot;&gt;[Fact(Skip=&amp;quot;...&amp;quot;)]&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Often times developers will write tests to verify the functionality of a module at a particular time but fail to
write the test in such a way that it can be run consistently in the future.
I have observed four main causes of this:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;The test depends on some external state that is difficult to construct&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;In some cases these challenges are very real. But I encourage you to apply the initial investment
so that your tests can protect you against future changes. In my experience, once these test are excluded from the
test runs, they are rarely revisited. This means that all of the value gained from that test is realized during the
micro-development cycle in which it was written and afterwards provides no value to the project. With some extra
effort you will continue to reap benefits from that test for as long as that functionality exists.&lt;/p&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;&lt;strong&gt;The test has external side effects&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Generally, with a little effort and some clean up code—in xUnit this is done via &lt;code class=&quot;language-text&quot;&gt;Dispose()&lt;/code&gt;—this can be easily handled in most cases.
In part 2 of this blog post, I’ll demonstrate how to make your tests transactional so that you don’t even have to think
about this issue.&lt;/p&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;&lt;strong&gt;The test is flaky&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;A flaky test is one that fails intermittently making the source of the error difficult to track down or reproduce.
Flaky tests are usually a sign that something else is going on and it may actually be a bug in your application or library.
Often times a test that fails intermittently is a sign that there is some boundary condition the test creates that is not
properly handled by the application. It could also mean that the test is not correctly testing the piece of functionality it
was intended to test and should be re-evaluated. Later on in this post I’ll demonstrate one way to deal with intermittently
failing tests caused by input data.&lt;/p&gt;
&lt;ol start=&quot;4&quot;&gt;
&lt;li&gt;&lt;strong&gt;The test is long running&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Long running tests can be a pain because you don’t want to run them every time locally if you don’t expect the behavior to
be affected. However, there are alternatives to labelling them as explicit. You can also decorate your xUnit tests with
&lt;code class=&quot;language-text&quot;&gt;Trait&lt;/code&gt;s and then filter by those. For example, if you want to skip long running tests you can label them as
&lt;code class=&quot;language-text&quot;&gt;[Trait(&amp;quot;Exclude&amp;quot;,&amp;quot;Local&amp;quot;)]&lt;/code&gt;. Then you can run all tests that haven’t been excluded locally.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;dotnet test --filter Exclude!=Local&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;You can also filter your tests by the domain you’re working on. By default the test runner will filter by the FullyQualifiedName.
So, if you’re working on several layers of your stack that are all namespaced under &lt;code class=&quot;language-text&quot;&gt;Articles&lt;/code&gt;, you can just:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;dotnet test --filter Articles&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h2&gt;Factories&lt;/h2&gt;
&lt;p&gt;Factories are an excellent way to reduce the boilerplate for individual tests.
If you’re not familiar with factories, they are a &lt;a href=&quot;https://en.wikipedia.org/wiki/Creational_pattern&quot;&gt;creational pattern&lt;/a&gt;
that abstract the instantiation process of a type.
The simplest form a factory can take is:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;BeerFactory&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; Beer &lt;span class=&quot;token function&quot;&gt;Create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Beer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;The most common use of Factories is to provide a mechanism for the instantiation of different implementations of an
interface that is dependent upon some runtime condition. Often times this takes the form of a switch statement:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;BeerFactory&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; IBeer &lt;span class=&quot;token function&quot;&gt;Create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;BeerType beerType&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;switch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;beerType&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; BeerType&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Ale&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Ale&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; BeerType&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Stout&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Stout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; BeerType&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Lager&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Lager&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;However, we’re going to discuss an entirely different use case for Factories: test model instantiation.
We will use factories in our tests to:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Isolate model creation&lt;/li&gt;
&lt;li&gt;Generate fake data and add entropy to our tests&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The idea of using factories for test data is by no means a new concept and is ubiquitous in other communities.
However, I rarely see their use in .Net projects so, I wanted to write this post to try and make the concept
more relatable and concrete for .Net developers who may not be familiar with this practice.&lt;/p&gt;
&lt;p&gt;To start let’s consider the following test case that is intended to compute the cost of an item.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; Task &lt;span class=&quot;token function&quot;&gt;GetPrice_Returns_The_Expected_Item_Price&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// arrange&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; item &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ShoppingCartItem&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        Name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Beer&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        UnitCost &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5.00&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        Count &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        CostType &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; CostType&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Count
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; expectedCost &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;UnitCost &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Count&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; itemCostCalculator &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ItemCostCalculator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// act&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; actualCost &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; itemCostCalculator&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GetTotalPrice&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;item&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// assert&lt;/span&gt;
    Assert&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Equal&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;expectedCost&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; actualCost&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;This test seems fine, but it’s very static. Every time it runs it will do the same thing without variation
and doesn’t flex the system very much. Alternatively, we could generate random values and manually construct
our instance:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; item &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ShoppingCartItem&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    Name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Guid&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;NewGuid&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ToString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;N&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    UnitCost &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;GetRandomDecimal&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    Count &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;GetRandomInteger&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    CostType &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token generic-method function&quot;&gt;GetRandomEnum&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;CostType&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;This is better because we alter the inputs to our system under test (SUT) on every test run.
However, the problem with this is that you will have to write code that performs the generation
of these random values and it will not be reproducible in the event of a failure
(i.e. using &lt;code class=&quot;language-text&quot;&gt;Guid&lt;/code&gt; for strings is not going to be reproducible).&lt;/p&gt;
&lt;p&gt;Luckily, others have already done this kind of work for us. Some great projects for .Net are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/bchavez/Bogus&quot;&gt;Bogus&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/FakeItEasy/FakeItEasy&quot;&gt;FakeItEasy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/jonwingfield/Faker.Net&quot;&gt;Faker.Net&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/nbuilder/nbuilder&quot;&gt;NBuilder&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I’ll be using Bogus, but you can do the same kinds of things with any of the above packages.&lt;/p&gt;
&lt;p&gt;So, to begin let’s see an example of how we can create a factory for our &lt;code class=&quot;language-text&quot;&gt;ShoppingCartItem&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;using&lt;/span&gt; Bogus&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ShoppingCartItemFactory&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; List&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;ShoppingCartItem&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; count &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Faker&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;ShoppingCartItem&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;RuleFor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; f&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Commerce&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Product&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;RuleFor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;UnitCost&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; f &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; f&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Random&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Decimal&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;min&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;RuleFor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Count&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; f &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; f&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Random&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;min&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;RuleFor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Weight&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; f &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; f&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Random&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Decimal&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;min&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;RuleFor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;CostType&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; f &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; f&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Random&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method function&quot;&gt;PickRandom&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;ItemType&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Generate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Then in our tests we can use our factory:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; Task &lt;span class=&quot;token function&quot;&gt;GetPrice_Returns_The_Expected_Item_Price&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// arrange&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; item &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ShoppingCartItemFactory&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;First&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; units &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ItemType &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; ItemType&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Weighed&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Weight
        &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Count&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; expectedCost &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; units &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;UnitCost&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; itemCostCalculator &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ItemCostCalculator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// act&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; actualCost &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; itemCostCalculator&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GetTotalPrice&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;item&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// assert&lt;/span&gt;
    Assert&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Equal&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;expectedCost&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; actualCost&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;So, we’re now generating fake data that may even resemble some of the actual inputs our system will receive.
And our test is a little more pleasant to read.
But, what kind of scenarios exist that fake data can actually help us catch?
Consider the following requirement:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The total cost is the unit cost multiplied by the count if the unit is priced by count.
However if the unit is priced by weight, then the total cost is the unit cost multiplied by the
weight of the unit.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Okay so now consider a faulty &lt;code class=&quot;language-text&quot;&gt;ItemCostCalculator&lt;/code&gt; implementation that does not take item type
into consideration and assumes all items are priced by count:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ItemCostCalculator&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;decimal&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;GetTotalPrice&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ShoppingCartItem item&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Count &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;UnitCost&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Our original test would have passed every time because we only ever tested the count condition.
However, we will get intermittent failures of our new test, because we expect the calculator to correctly
compute cost based on &lt;code class=&quot;language-text&quot;&gt;ItemType&lt;/code&gt;. We can now fix our &lt;code class=&quot;language-text&quot;&gt;ItemCostCalculator&lt;/code&gt; and the test will pass every time.&lt;/p&gt;
&lt;p&gt;I would like to quickly point out that in this example you &lt;strong&gt;should&lt;/strong&gt; write
multiple tests that test both conditions separately. However, the regular
use of fake data generation in tests helps us to catch mistakes like this one.&lt;/p&gt;
&lt;h3&gt;Reproducing Flaky Tests&lt;/h3&gt;
&lt;p&gt;One challenge with using generated data is that it can be difficult to reproduce failures locally.
So, the tests may fail during CI, but if you can’t reproduce them consistently then it can be difficult to
track down root cause. I was recently working with &lt;a href=&quot;https://github.com/rtablada&quot;&gt;Ryan Tablada&lt;/a&gt; on this
exact issue and the solution he proposed was to use the same seed for all data generation tests and log that seed
at the beginning of the test. This seed can be overridden by an environment variable, allowing us to re-run the
tests with the same fake data.&lt;/p&gt;
&lt;p&gt;Each test can inherit from a base test fixture that sets the seed in its
&lt;a href=&quot;https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/static-constructors&quot;&gt;static constructor&lt;/a&gt;.
The CLR ensures that static constructors are only called once per process making this operation thread safe.
Since it is only called once, all tests will use the same seed and you will only log the seed once at the beginning
of the run.&lt;/p&gt;
&lt;p&gt;Prior to .Net Core static constructors would be invoked per AppDomain rather than per process.
However, the AppDomain no longer exists so this is a non-issue for .Net Core users.
If you’re using an older testing framework (e.g. &lt;a href=&quot;http://nunit.org/docs/2.6.3/assemblyIsolation.html&quot;&gt;NUnit&lt;/a&gt;)
that provides AppDomain isolation between individual tests, this exact solution will probably not work for you.
However, most testing frameworks provide a way to share state across all tests, so using their built-in APIs should work.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ItemCostCalculator_Tests&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; TestFixture &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;/*...*/&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TestFixture&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; Seed&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;TestFixture&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; currentSeed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Bogus&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Randomizer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Seed&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; seedOverride &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Environment&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GetEnvironmentVariable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;TEST_SEED&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        Seed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;seedOverride &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Parse&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;seedOverride&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; currentSeed&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        Console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;$&lt;span class=&quot;token string&quot;&gt;&quot;Using test seed: {Seed}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Now in the instance constructor, we assign the seed back to the Bogus randomizer.
This will ensure that each individual test runs with the correct seed.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TestFixture&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; Seed&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;TestFixture&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; currentSeed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Bogus&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Randomizer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Seed&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; seedOverride &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Environment&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GetEnvironmentVariable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;TEST_SEED&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        Seed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;seedOverride &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Parse&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;seedOverride&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; currentSeed&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        Console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;$&lt;span class=&quot;token string&quot;&gt;&quot;Using test seed: {Seed}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;TestFixture&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        Randomizer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Seed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Random&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Seed&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;By assigning the seed to the Bogus &lt;code class=&quot;language-text&quot;&gt;Randomizer&lt;/code&gt; in the instance constructor we can ensure that
each individual test within a test run will use the same seed.
So, when we get the intermittent failure described above, we should be able to go to our test log
and see something like:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Using test seed: 73202934&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;We can then pull the branch locally and set the environment variable:&lt;/p&gt;
&lt;p&gt;CMD:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;setx TEST_SEED 73202934&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Bash:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;export TEST_SEED=73202934&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Now, when we re-run the test, the model factories will use the same seeds and generate
the same fake data causing the test to fail again.&lt;/p&gt;
&lt;h2&gt;Summary&lt;/h2&gt;
&lt;p&gt;Using test model factories to generate fake data for our unit tests is a good way to increase the coverage
of our tests across multiple runs while also providing the added benefit of making our tests more legible.
By adding randomness to our tests we can discover issues that may never be discovered through the use of
static test data.&lt;/p&gt;
&lt;h2&gt;What’s Next&lt;/h2&gt;
&lt;p&gt;In my next post on .Net testing, I will show some ways we can make tests with side-effects idempotent via
test cleanup methods and transactional integration testing.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[A Strategy for the Measurement and Optimization of .NET Application Performance]]></title><description><![CDATA[This is a cross-post from  stackify.com Introduction It’s Friday afternoon, the majority of the development staff has already packed up and…]]></description><link>https://jaredcnance.github.io//dotnet-performance-optimization/</link><guid isPermaLink="false">https://jaredcnance.github.io//dotnet-performance-optimization/</guid><pubDate>Fri, 12 Jan 2018 00:00:00 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;This is a cross-post from &lt;a href=&quot;https://stackify.com/net-application-optimization&quot;&gt;stackify.com&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;It’s Friday afternoon, the majority of the development staff has already packed up and headed home for the weekend, but you remain to see the latest hotfix through to production. To your dismay, immediately after deployment, queues start backing up and you begin to get alerts from your monitoring system. Something has been broken and all evidence points to an application performance bottleneck.&lt;/p&gt;
&lt;p&gt;This experience is all too common for developers and software team managers. What can we do to prevent poor performing code from reaching our production environment and bringing our “guaranteed 0% downtime” platform to its knees under the load of production volume? The answer lies in proper pre-production processes that validate our changes have not had substantial negative performance impacts.&lt;/p&gt;
&lt;p&gt;In this article, I propose a workflow for measuring performance, diagnosing potential issues, and validating the efficacy of improvements. It’s an iterative process of discovery, profiling, refactoring, testing, benchmarking, and monitoring.&lt;/p&gt;
&lt;p&gt;The sample application used in this article can be found on GitHub.&lt;/p&gt;
&lt;h2&gt;Code Reviews&lt;/h2&gt;
&lt;p&gt;Performing code reviews is an essential part of maintaining some quality control over code before it reaches production. Code reviews allow your team members to read through your changes and, using their best judgment, approve or suggest changes to your work. This also helps the entire team keep abreast of all changes that are important to them.&lt;/p&gt;
&lt;p&gt;However, code reviews take up time of other engineers and can sometimes be less thorough than desired. The thoroughness of a review is rarely communicated to the team and so an approval can provide a false sense of security that the code is indeed production-ready.&lt;/p&gt;
&lt;p&gt;Another failure point is that code reviews rarely include any kind of quantitative feedback. In other words, I can suggest method A will be faster or allocate less than method B, but I am unlikely to take the time to prove the quantitative impact of my assertion.&lt;/p&gt;
&lt;p&gt;Finally, things simply get missed. Changes can be made in isolation from the consuming code and a reviewer may not be aware of the context in which a particular set of changes is being executed. For example, adding a simple one-time string concatenation may be fine, but if the consuming code is iterating over the changed code millions of times, then we may have just introduced some significant performance bottleneck.&lt;/p&gt;
&lt;p&gt;In summary, code review is an indispensable part of the development process. It aids in maintaining style consistency, knowledge transfer, developer education and overall quality control. But, it should not be viewed as a method for ensuring that the implementation does not have any adverse or out-of-bounds performance impact.&lt;/p&gt;
&lt;h2&gt;The Application&lt;/h2&gt;
&lt;p&gt;The example application used in this blog post can be found on GitHub. It is a simple .NET Core web API application. The focus of this post is on the /people?name={name} route. This request will search our database of People and perform a fuzzy string match on the name, returning the entire list sorted from most to least similar. For the sake of simplicity, we will only implement one matching algorithm: Levenshtein Distance.&lt;/p&gt;
&lt;p&gt;I recommend taking a quick look at the GitHub project. The call stack we’ll be focused on looks like:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/jaredcnance/FuzzySearch/blob/e01fd327ea988889b8878a5dbbd699e1c617a4ee/API/Domain/People/PeopleController.cs#L17-L21&quot;&gt;PeopleController.GetAsync&lt;/a&gt;
&lt;br /&gt;
└── &lt;a href=&quot;https://github.com/jaredcnance/FuzzySearch/blob/e01fd327ea988889b8878a5dbbd699e1c617a4ee/API/Domain/People/PersonService.cs#L31-L37&quot;&gt;PersonService.SearchAsync&lt;/a&gt;
&lt;br /&gt;
　 　 └── Enumerable.OrderBy
&lt;br /&gt;
　　　 　 └── &lt;a href=&quot;https://github.com/jaredcnance/FuzzySearch/blob/e01fd327ea988889b8878a5dbbd699e1c617a4ee/API/Services/FuzzyComparer.cs#L20-L35&quot;&gt;FuzzyComparer.Compare&lt;/a&gt;
&lt;br /&gt;
　　　　　 　 └── &lt;a href=&quot;https://github.com/jaredcnance/FuzzySearch/blob/e01fd327ea988889b8878a5dbbd699e1c617a4ee/API/Services/LevenshteinFuzzySearch.cs#L16&quot;&gt;LevenshteinFuzzySearch.ComputeSimilarity&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;Discovery&lt;/h2&gt;
&lt;p&gt;Application Performance Management (APM) tools, such as Prefix and Retrace, can be used to identify poorly performing applications at a high level. This investigation enables local discovery of performance issues, and helps us narrow our focus before using a more detailed profiling utility.&lt;/p&gt;
&lt;h3&gt;Local Development Environment&lt;/h3&gt;
&lt;p&gt;In this example, I will use Prefix (a free tool from Stackify) to evaluate the distribution of work. This will help me understand what operations contribute the most to overall response time in the request. Perform these steps to get started.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Install Prefix on Windows&lt;/li&gt;
&lt;li&gt;Launch Prefix in your browser by clicking the tray icon&lt;/li&gt;
&lt;li&gt;Start the application&lt;/li&gt;
&lt;li&gt;Send a request with the search filter applied&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/prefix-1-ee0b0123bf7bc68f1f091a08d3af3cae-9160a.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAARlAAAEZQAGA43XUAAABFklEQVQY0yXPSVeDMBQFYP6JWq1HQNoCLXMoFFrC1CLKUBd6rDv///76CIvv3DDk5kWKuz+E5Sf8bCA9WD6KnAR8gJO+Y8NqGPuLsA5qbIIKu7ihLLGJO1jHDvvsDDdpIDHeUcmAsBjBSFhcxVoor6JQdgq82DkUt4DFe2ypbCo0owvMsCI13GyEvEshHZpvZN0vso8bcsoJ72/0/ANO75LLF5W2sJOWJizgVxWt32DF5DBp56QD9KCApLkZtukAg05RdwlUK4VqH6FQTlfaRmdoLqdrl9D8CrJV0iQnypOYaJbQ//Me6VHzsNQjPK0Z7hSbOLhXXWGxYnimb6bhwWEcK3aG7FVY2sSpsdAPeNB8EsxePfwDVDmuPlNDUNYAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;prefix 1&quot;
        title=&quot;&quot;
        src=&quot;/static/prefix-1-ee0b0123bf7bc68f1f091a08d3af3cae-fb8a0.png&quot;
        srcset=&quot;/static/prefix-1-ee0b0123bf7bc68f1f091a08d3af3cae-1a291.png 148w,
/static/prefix-1-ee0b0123bf7bc68f1f091a08d3af3cae-2bc4a.png 295w,
/static/prefix-1-ee0b0123bf7bc68f1f091a08d3af3cae-fb8a0.png 590w,
/static/prefix-1-ee0b0123bf7bc68f1f091a08d3af3cae-526de.png 885w,
/static/prefix-1-ee0b0123bf7bc68f1f091a08d3af3cae-9160a.png 1024w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;As you can see from the above screenshot, the majority of the work is consumed by our .NET application code while a minor portion is consumed by I/O. From this I can quickly tell that this particular request has a risk of running as slow as 2.2 seconds on the first request and around 900 ms for subsequent requests. This is beyond the threshold of perceived user control. According to &lt;a href=&quot;https://www.nngroup.com/articles/powers-of-10-time-scales-in-ux/&quot;&gt;Jakob Nielson&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;new pages must display within 1 second for users to feel like they’re navigating freely&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;And it is significantly beyond the 0.1 second threshold of perceived instantaneity.&lt;/p&gt;
&lt;h3&gt;Staging Environment&lt;/h3&gt;
&lt;p&gt;Prefix is a great tool for uncovering errors or performance issues in your local dev environment, but it can be difficult or impractical to reproduce production scenarios locally. Tools like Retrace are excellent at providing these same kind of insights in remotely deployed environments. Retrace will not only help detect production issues, but can also be used to discover issues in a staging environment so that bugs and performance problems are discovered early in the release cycle. Through log management, application monitoring, metrics and alerts you can quickly improve the quality of your release process. Retrace’s &lt;a href=&quot;http://stackify.com/deployment-tracking/&quot;&gt;deployment tracking&lt;/a&gt; features also enable you to identify performance issues caused by recent changes to application code.&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/retrace-1-d4b0428c188c7c15bf03bfbbf142cada-53a6b.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 60.105448154657296%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAAChElEQVQoz01SS2tTQRS+Ozf+AH+AiGvRKvjA4sq9L6iPIoq1RYu0FMTHRrAiiHXRVNF9ERcqShvbtMm9SYs2adKkNzRpjfRh0uTeedx53WeS6xhceOabb5iP8505cEYZuD/Q3Tty9ubIiZ67J3oGz1wfOX1t6Nilgf9x9GL/4XO3jpzv67pwu7t3+NTVezLz5OVBxSLMtYXRqFcqFQCh7dhCLtt2/oUUHMYZhJAS4sroiL7nYoSUqoGLlWpps24iYgIIAMQWNxFvQNoABGCOiUB/2ZaiAWjNpCbmuyYFmCibVfA+vjy1WMDVXVyr+cINm2EraLtOIA2OHcirJzzf8V3hurZPGtCX1QHRMgWFcB7T16dzpWgyHUsXPmZWoytrqv4zoa+r+kYsX/qaWZ3K6NFsca5QjuXLs8v6l/j3nV1jMVtQLMeJLGgRNfFuIfVmMfkiGY8k5t9qiYgWj6hqZH5uXI1LnpAsoakTKe2VplZMc2mlqDSDIAzbodyttm1RT3BGmcssSlGTCg9bnkUDZLmM+Qw1XS9stsKgaTuelskrCJHpH/q39Np2tfG7jg1s1wA3sdiqW+VtU7KBhAEFpoJxmzJBhMOEQwjXllaUKuDJ1Y10adPEFHMXECEBqQ2ZU4cMELthcdfzc7/ITB6miii5tDOTM+cKKJrKKVugJntutVp+0PT9QA6YUkYoleBcMCbHA2TCjQ+f9zwYPfDk+f7Hj/Y9fbb34ejYp1nFqu0Erbbrep3wHcel0sG5dHfMDCIQtsLx6eErYwf7It39r7uGJo7feXlocmpS4diE8hNwLp2yhHyZdcwWIfKUXSCEvSDg2zUzqzfy6yi/ZmTL9XQJ1s0/yzpSypE3txsAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;retrace 1&quot;
        title=&quot;&quot;
        src=&quot;/static/retrace-1-d4b0428c188c7c15bf03bfbbf142cada-fb8a0.png&quot;
        srcset=&quot;/static/retrace-1-d4b0428c188c7c15bf03bfbbf142cada-1a291.png 148w,
/static/retrace-1-d4b0428c188c7c15bf03bfbbf142cada-2bc4a.png 295w,
/static/retrace-1-d4b0428c188c7c15bf03bfbbf142cada-fb8a0.png 590w,
/static/retrace-1-d4b0428c188c7c15bf03bfbbf142cada-526de.png 885w,
/static/retrace-1-d4b0428c188c7c15bf03bfbbf142cada-53a6b.png 1138w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;Here is an example of what it looks like in Retrace’s performance view (the red arrows are pointing to the deployment markers).&lt;/p&gt;
&lt;h3&gt;Profiling&lt;/h3&gt;
&lt;p&gt;Now that we’ve identified—at a high level—an execution code path of interest, we can dive a little deeper by using a profiler. There are several different profiling options, most of which are personal preference. Visual Studio comes with a Performance Profiler, but there are alternatives such as JetBrains dotTrace and dotMemory. I should mention that the only profiler I was able to get to consistently work with .NET Core was Visual Studio Performance Profiler while debugging. In addition to the debugging profiler, Visual Studio comes with several &lt;a href=&quot;https://docs.microsoft.com/en-us/visualstudio/profiling/profiling-feature-tour&quot;&gt;other options&lt;/a&gt;, most of which do not yet work with .NET Core. For a quick overview of the Visual Studio Profiler, I will defer to &lt;a href=&quot;https://docs.microsoft.com/en-us/visualstudio/profiling/beginners-guide-to-performance-profiling#BKMK_External_Code&quot;&gt;the official documentation&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Your approach to profiling should probably depend on the application type. For long-running applications with a constant and stable workload, you can sometimes get quick behavioral insights from just the CPU and memory charts. Before I dive into profiling the sample application, I’ll cover two common scenarios you may encounter while profiling.&lt;/p&gt;
&lt;h4&gt;Memory leaks&lt;/h4&gt;
&lt;p&gt;The first example shows an app that executes a job every few seconds. You can see the memory being consumed by our application is continuing to grow and doesn’t appear to have any correlation to CPU usage. In this particular case, we’re seeing a memory leak where each unit of work in the application is leaking references and so they are not being cleaned up.&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/memory-leak-0f3fc71a4e7029e89406e21a65c2d150-95632.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 576px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 41.14583333333333%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABlklEQVQoz2XRW2sTQRjG8f0k1e3u7GF2NwnsprupqbV7SjUIgcYkDYnYC+udgodaBam1tQZBERH1yq/6d3ZTqDYXP+adZ3jnwGjtdkyWZRR5RpYX9HoFRbmL50kavsSXLrZlkXVbRBsJ0eY26VaHeCNiMy1J2hFldpskjhHCRgsaTRK12JAmrmXS8kxu3tDxbIM4CgjDBjJoEoQxdwp1aL/P3eGI/mRKOj6gNzvk8PiIe5MZnvTQ1vV1HF9t2hvQvT9ie29OOXvC7sFTBs/eMzz6xP67r0xPvrF/8p3p6Y/a7OwXDy9+Mz//yXzxh3z6GH1tDc3QdbLBSDV9YfL2M+NLdX28YPT6ggevPirnSy/PasPKiw/sPT9l/GZBMX6EMAy0JOmQFyW3ulvs7KSkWU6a5sQqdxyJq56xyr/GQ3o+vqI1my0qQlhYlo1jO7WqrjIhBMK8ps6ty1pgGma9aRhG6slqYpqWIjCMiskyWzZW46rV3FI/XPVpVdHuhDjSwVY3s50rjusq/8yd/9ev2PhBgHQlfwEQmBAa2s4BXQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;memory leak&quot;
        title=&quot;&quot;
        src=&quot;/static/memory-leak-0f3fc71a4e7029e89406e21a65c2d150-95632.png&quot;
        srcset=&quot;/static/memory-leak-0f3fc71a4e7029e89406e21a65c2d150-9d04d.png 148w,
/static/memory-leak-0f3fc71a4e7029e89406e21a65c2d150-f1dcb.png 295w,
/static/memory-leak-0f3fc71a4e7029e89406e21a65c2d150-95632.png 576w&quot;
        sizes=&quot;(max-width: 576px) 100vw, 576px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;h4&gt;Overworked services&lt;/h4&gt;
&lt;p&gt;The next example shows an unbound and unthrottled event processing application. In other words, it processes real-time events as they occur. We can see that while memory is increasing, so is CPU. This may be an indication that the application is just doing too much work, possibly in parallel. We may need to implement some kind of throttling. That could be an out-of-process mechanism—such as limiting the number of unacknowledged messages that should be delivered to a queue (in the case of AMQP). Or it could be an in-process mechanism—such as using a Semaphore. Or maybe we just need to scale our services to handle the load. But without diving in, there’s not much else we can infer from the graphs.&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/overworked-service-bffeffc327e2fd44a003353eafc300ff-56a1e.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 578px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 42.214532871972324%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAAB3UlEQVQoz2WRWU8TYRSG+z+8EDr70mmnzNhV7HQotGJj6WZaQTQ2EmPiQsGqkbgAKlGMMdFbfoA/8vF0asKFF0/Od863nO99T8rPr1CrRdTjmHitQS2KaDZbuK6LYZiYpmAYRJUcfj4gW6qzWikTBgGlqEExDKmWikluyLmU63qs5POoy0voShpD09EFTdXQdAPDtDBtFzuTI5MP8YsVivUm5fU21c0e0daY9fGE6PYQL+ORUhUVJxdQH94nHk3Y2H3CzckL2o9ndJ4e0Zt+ZPjqjNHRd8bvfnD3/c+E7eNf7Jz8Tnjw9YJbe1PSS8ukNFXl+kabsVwYvf3Gnddn8sCXf3xmOPvE4OUpg8NT+ocn9A+OL5FmvekHBnKmubOHIYpSQXiNRmOdcrkiPq6Jh+KlxEqlmsi1bOd/nMtoWoJpJ3nGE8meJ2b7PvOf6rKh214yBF26aZq28FKiquooaVXQRJqa1ObRdi0yOYdcMJ9FKJJlAKq6uKhoJmndYe6romiL+nxf1pZjYWctvMAlGhaSmisPdffrPPvTpbNf4+oV8dCSX3lelowvElyHbMEnqGYJV31q3QI3tgo0tsu0HlYZvInpHkTcO29S6xfoPI/YPW/x6GKT3izGMh3+Akx2GE5rNSSzAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;overworked service&quot;
        title=&quot;&quot;
        src=&quot;/static/overworked-service-bffeffc327e2fd44a003353eafc300ff-56a1e.png&quot;
        srcset=&quot;/static/overworked-service-bffeffc327e2fd44a003353eafc300ff-8869e.png 148w,
/static/overworked-service-bffeffc327e2fd44a003353eafc300ff-87a4d.png 295w,
/static/overworked-service-bffeffc327e2fd44a003353eafc300ff-56a1e.png 578w&quot;
        sizes=&quot;(max-width: 578px) 100vw, 578px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;h3&gt;Sample application results&lt;/h3&gt;
&lt;p&gt;In our example application, there’s not much we can learn from the graphs themselves. However, since we’ve already identified a particular route of interest, we can set breakpoints to record memory and CPU usage around areas of interest. For this application, I set breakpoints in the service layer to capture the resource consumption of our search service.&lt;/p&gt;
&lt;p&gt;Below are the results from profiling the sample application. We can quickly see that we’re spending most of our CPU time in our fuzzy comparison function. This should not surprise us. Looking a little bit deeper we can see that 30% of the time spent within this function is spent in &lt;code class=&quot;language-text&quot;&gt;System.String.Substring(/*...*/)&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/profiler-1-29558d2dcf98c3c1fe827c2a106025a5-9160a.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 32.51953125%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAARlAAAEZQAGA43XUAAABLElEQVQoz5WRS07DMBCGcw8a8rJj5+XGeTgJaVqBVBCX4AScBLFAIO7QrhHn+xkbKth0weLTP5rFN+OxZ8wAy7JsMY4Tuq5H/9MzxmAYRii1hpQZOE8djEhS4ZBFCZHliKkXpyk83XRoW4Nx2kDrDlVVo6b87veo65YGzTDDhEa3UDTgoWrxnmo8iwavssULr/EUlXij9KzAUpZrnGqlGhI1KGi6lDmEyBw51VFZ4THT+PRLHIMKx1WOw0WGA+WHX8D7KzqJ1bpBTrIkTsAY/yVh7mkbkt5Lib0QuI5i7IIQW+KW8zNCZbernOR0N4eV0t1GGnYjBZaUYwwuMYWByx1j54T6rDChnOmT7ooCWxLMJLNcBQH2mfy/0G445AUm30e/WmGgtBhiDkN8AVEs2Rf+MWTuAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;profiler 1&quot;
        title=&quot;&quot;
        src=&quot;/static/profiler-1-29558d2dcf98c3c1fe827c2a106025a5-fb8a0.png&quot;
        srcset=&quot;/static/profiler-1-29558d2dcf98c3c1fe827c2a106025a5-1a291.png 148w,
/static/profiler-1-29558d2dcf98c3c1fe827c2a106025a5-2bc4a.png 295w,
/static/profiler-1-29558d2dcf98c3c1fe827c2a106025a5-fb8a0.png 590w,
/static/profiler-1-29558d2dcf98c3c1fe827c2a106025a5-526de.png 885w,
/static/profiler-1-29558d2dcf98c3c1fe827c2a106025a5-9160a.png 1024w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/profiler-2-b0bf6ba4e8210f5f30b6fdc4a8db1920-dd3ab.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 29.018338727076593%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABXElEQVQY0yVQy07DMBDMB8CRCoEQTdw2DydN87Cdpnk1bblwggMSIA4t4vUVCC6VaKH0iwfbHEar3Z2d8dhwX/awH7/hPu9gP/3Afdrh9GGDzv0GR7drHF69w1puEbzt0bn5xMH1B8hqi8HyC/7rL3qr/93x3VrvDOZ7SMJAg0dDiHika8kTsNCHdXaCOKAYswQO6cKxzuU+1PwsjZHKymRPBwREco1L1wMvaxRFhWbaop3NkRcl4oTBowG6JkEUp5gvLnSv0ExnmEjObL5A3bTIJwWCYQiL9GE4jqOb0SgCFwIiy5CNcwTBEN2uCdO0YNsOxnKmaq/XB2MccSwTMIYkSSHknbpXXMOVL4yiWA8o9TU8j+pjRVBwHFcmKHVVgkJkEFxgkhfaKE1TKB3LIjB8P9BDhbKsMJURMnmgnJWREqSUYi7jKaOBbaOq1BcVaGX0um7AOdeChPTwByhxxZh7gkvWAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;profiler 2&quot;
        title=&quot;&quot;
        src=&quot;/static/profiler-2-b0bf6ba4e8210f5f30b6fdc4a8db1920-fb8a0.png&quot;
        srcset=&quot;/static/profiler-2-b0bf6ba4e8210f5f30b6fdc4a8db1920-1a291.png 148w,
/static/profiler-2-b0bf6ba4e8210f5f30b6fdc4a8db1920-2bc4a.png 295w,
/static/profiler-2-b0bf6ba4e8210f5f30b6fdc4a8db1920-fb8a0.png 590w,
/static/profiler-2-b0bf6ba4e8210f5f30b6fdc4a8db1920-526de.png 885w,
/static/profiler-2-b0bf6ba4e8210f5f30b6fdc4a8db1920-dd3ab.png 927w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;Historically, this wouldn’t have been our first choice for optimization. However, since the introduction of System.Span in C# 7.2, we now have a tool for improving some of these string parsing operations. Now that we have a candidate for optimization, the next step is to write benchmarks against the current implementation so that we can accurately quantify our improvements.&lt;/p&gt;
&lt;h2&gt;Benchmarking&lt;/h2&gt;
&lt;p&gt;Benchmarking is a critical step when making performance improvements. Without it, we have no way to validate the impact of our changes.&lt;/p&gt;
&lt;h3&gt;Writing benchmarks&lt;/h3&gt;
&lt;p&gt;I don’t think there is any argument that the best tool for writing benchmarks for .NET today is &lt;a href=&quot;https://github.com/dotnet/BenchmarkDotNet&quot;&gt;BenchmarkDotNet&lt;/a&gt;. Lots of people are using this tool today including &lt;a href=&quot;https://github.com/aspnet/Mvc/blob/bfb5f23647f440e4b83045efe0afc3a234195bdb/benchmarks/Microsoft.AspNetCore.Mvc.Performance/Microsoft.AspNetCore.Mvc.Performance.csproj#L15&quot;&gt;the AspNetCore team&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I like to approach benchmarking in a very similar fashion to unit testing. For every project in the solution, I will create a corresponding benchmark project. The benchmark project will mirror the organization of the classes in the project under test. Each benchmark gets prefixed with the name of the system under test (e.g. Foo_Benchmarks.cs). This makes them easier to find later and distinguishable when locating types by name.&lt;/p&gt;
&lt;h3&gt;Running benchmarks&lt;/h3&gt;
&lt;p&gt;A benchmark application is just a console app that calls the benchmark runner. There are two approaches you can use in this entrypoint. The first is by explicitly listing the benchmarks you’d like to run:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Program&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        BenchmarkRunner&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method function&quot;&gt;Run&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Foo_Benchmarks&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        BenchmarkRunner&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method function&quot;&gt;Run&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Bar_Benchmarks&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;The second is a command line switcher that will provide you a prompt to specify the benchmark you’d like to run, assuming one was not provided as an argument. This is particularly useful if your project has a lot of benchmarks since running benchmarks can consume a great deal of time.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Program&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; switcher &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;BenchmarkSwitcher&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Foo_Benchmarks&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Bar_Benchmarks&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        switcher&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/benchmarks-1-7d4893e14a119387491903daefb9a359-3c2f0.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 19.37901498929336%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsSAAALEgHS3X78AAAAdUlEQVQY05WQSRaAIAxDcx7nCcR5uP+dKrH6ZOFCF3kNfTT9ANhF0O0Ct2mtJ0E5aM17QWQEsf0uFH64XVUMt/SbBqZOA/8ISSuvCsl4Dn163eFCKpw7qUhnFiWsRkEzP1/AnrnJvRpPXvQaxNfRZ97n3dk7AIbbcFXnP523AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;benchmarks 1&quot;
        title=&quot;&quot;
        src=&quot;/static/benchmarks-1-7d4893e14a119387491903daefb9a359-fb8a0.png&quot;
        srcset=&quot;/static/benchmarks-1-7d4893e14a119387491903daefb9a359-1a291.png 148w,
/static/benchmarks-1-7d4893e14a119387491903daefb9a359-2bc4a.png 295w,
/static/benchmarks-1-7d4893e14a119387491903daefb9a359-fb8a0.png 590w,
/static/benchmarks-1-7d4893e14a119387491903daefb9a359-526de.png 885w,
/static/benchmarks-1-7d4893e14a119387491903daefb9a359-3c2f0.png 934w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;h4&gt;Using diagnosers&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;http://benchmarkdotnet.org/Configs/Diagnosers.htm&quot;&gt;Diagnosers&lt;/a&gt; are one example of customizations you can use to improve your benchmarks. They can be attached to your benchmarks by decorating benchmark classes with attributes. My personal favorite is the &lt;code class=&quot;language-text&quot;&gt;MemoryDiagnoser&lt;/code&gt;, which provides cross-platform allocation and garbage collection detail.&lt;/p&gt;
&lt;h4&gt;Using test data&lt;/h4&gt;
&lt;p&gt;The setup, teardown and parameter specification for benchmarks has a pretty similar interface to NUnit. You can create Global and Iterative &lt;a href=&quot;http://benchmarkdotnet.org/Advanced/SetupAndCleanup.htm&quot;&gt;Setup/Cleanup methods&lt;/a&gt;.
You can also define compile-time constant parameters as members of the benchmark class or as an enumerable &lt;a href=&quot;http://benchmarkdotnet.org/Advanced/Params.htm#example-paramssource&quot;&gt;ParamsSource&lt;/a&gt;. For non compile-time constants, you will need to implement the IParam interface, which I have done &lt;a href=&quot;https://github.com/jaredcnance/FuzzySearch/blob/e01fd327ea988889b8878a5dbbd699e1c617a4ee/Benchmarks/Services/FuzzySearch_Benchmarks.cs#L43-L54&quot;&gt;in the example&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;There are many more features in BenchmarkDotNet and I highly recommend reading through their &lt;a href=&quot;http://benchmarkdotnet.org/&quot;&gt;documentation&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;Example output&lt;/h4&gt;
&lt;p&gt;The example benchmark uses non compile-time constant parameters to create some random string data to be passed into our distance function. In the example, I generate random strings of lengths 10, 100, 1000, and 10000, and compare each of them against a randomly-generated string of length 100. You can take a look at the generated Markdown results here.&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/benchmarks-2-4536674c748d499867c9ae44ee1547aa-9160a.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 21.2890625%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAARlAAAEZQAGA43XUAAAAtUlEQVQY04WMSxKCMBBEoyiKxVf0ECqSTCKKRPB3/zO1k7BwZbl49TI90xEbq7DuCNlFI28JxXUk5TluDFbGIFQnzOUJC/akaiD2Z4jDD+JGc2kkJIOIHWntvWQvOBO75sv+D9OqRVBfESiLoLpgpjpPcGwxJ85q3rvM3UhHN87S3dnR0vq3+0PkdEepn0hpQEEPbM0bBc8uK80LK3lDqgZP4sz3MbukJxLuRKpHRD1y7ma8+wBlxXKDDczuzwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;benchmarks 2&quot;
        title=&quot;&quot;
        src=&quot;/static/benchmarks-2-4536674c748d499867c9ae44ee1547aa-fb8a0.png&quot;
        srcset=&quot;/static/benchmarks-2-4536674c748d499867c9ae44ee1547aa-1a291.png 148w,
/static/benchmarks-2-4536674c748d499867c9ae44ee1547aa-2bc4a.png 295w,
/static/benchmarks-2-4536674c748d499867c9ae44ee1547aa-fb8a0.png 590w,
/static/benchmarks-2-4536674c748d499867c9ae44ee1547aa-526de.png 885w,
/static/benchmarks-2-4536674c748d499867c9ae44ee1547aa-9160a.png 1024w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;The first observation I would make is that the function’s execution time and allocations are linearly proportional to the size of the query parameter we are provided. What this means is that we have inadvertently created an attack vector for a bad actor. By not truncating the query string value, clients could invoke our API with long query strings in rapid succession. Based on the data, this would likely cause large CPU and memory spikes, potentially degrading our service or forcing us to scale.&lt;/p&gt;
&lt;p&gt;The next observation is the memory allocation. In the case of a 1k character string, we will allocate over 6.6 MB just for comparing strings and 66 MB if we get a 10k character string!&lt;/p&gt;
&lt;h2&gt;Fixing the Problem&lt;/h2&gt;
&lt;p&gt;Now that we understand the problem, we can implement a solution and validate the improvement with refactoring, unit tests, and benchmarking.&lt;/p&gt;
&lt;h3&gt;The process&lt;/h3&gt;
&lt;p&gt;Before we start making optimizations, we need to make sure that we have unit tests around the system we intend to affect. Without tests, we may improve performance but we also risk breaking existing functionality. So the iterative process for making performance improvements should look like:&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/process-1-9d38b0806d9cb700d0979aa6b7f4576b-e08ca.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 42.43902439024391%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABkElEQVQoz5WSW2/TQBCF/f//BZVCadLEVQKNS2kiqyC1QohCuEgENxdTt3USJ47v14/dNZV44IWRzu7O7syZM7urFUVBkiSkaUpZFmRZJuZS7ZXirKoqhTiOkbFZlitfxkhIS4uEOAvVWnPsJc8ODmgdHnKi9+j2ulyMxpjjEf3BgKura1qtFnpP582ZwVGng36i0+8PMIYGvh+w3Fp8tK9xgwe0NE/IRVWJJ3V5nqtqUlEYRkRR1KgTXUjl0peKJZTaqmQdPrL0btFu1z+Uk1WpSA7YbDxF6Ps+u91OJWd/CvzbajVGouWlN0Nbhy6f7Pe4kcO3yYQX7TamafL55obn4hqO20eMzUuVJNU/3enfkBakfkOoAqtCyU6KuKlZ1fyvxXnUENZ1k1wI0p/ud35t56RVzGK+YDabqban0ymWZeG6LrZt49w5rFYrtXd//6DEPO4d5hurIWxIa7xoxeTuA/tsy9fJF4anL3n39lK0bNI97jASr28YZ5yfv+bV8FT8Cl2sL9gGHgvPYp/4/AZHp1MtHJCK6wAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;process 1&quot;
        title=&quot;&quot;
        src=&quot;/static/process-1-9d38b0806d9cb700d0979aa6b7f4576b-fb8a0.png&quot;
        srcset=&quot;/static/process-1-9d38b0806d9cb700d0979aa6b7f4576b-1a291.png 148w,
/static/process-1-9d38b0806d9cb700d0979aa6b7f4576b-2bc4a.png 295w,
/static/process-1-9d38b0806d9cb700d0979aa6b7f4576b-fb8a0.png 590w,
/static/process-1-9d38b0806d9cb700d0979aa6b7f4576b-e08ca.png 615w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;h3&gt;The solution&lt;/h3&gt;
&lt;p&gt;In our example application, I’m going to replace
&lt;a href=&quot;https://github.com/jaredcnance/FuzzySearch/blob/c91eb96671854502e1150c65e80586c30d9c3856/API/Services/LevenshteinFuzzySearch.cs#L48&quot;&gt;the use of string.Substring&lt;/a&gt;
with &lt;a href=&quot;https://github.com/jaredcnance/FuzzySearch/blob/e01fd327ea988889b8878a5dbbd699e1c617a4ee/API/Services/LevenshteinFuzzySearch.cs#L48-L51&quot;&gt;the new &lt;code class=&quot;language-text&quot;&gt;Span&amp;lt;T&amp;gt;&lt;/code&gt;&lt;/a&gt;
introduced in C# 7.2. For a great introductory on this new type, check out &lt;a href=&quot;https://channel9.msdn.com/Events/Connect/2017/T125&quot;&gt;Jared Parson’s video on Channel 9&lt;/a&gt;.
For a more in-depth look at Span and how you can use it today,
check out &lt;a href=&quot;http://adamsitnik.com/Span/#how-to-use-it-today&quot;&gt;this post by Adam Sitnik&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Span&amp;lt;T&amp;gt;&lt;/code&gt; allows us to work with contiguous memory in a type safe way. In the case of string parsing, this means we can iterate over the characters of a string and use an indexer to access characters without allocating a new string – string.Substring allocates new strings everytime.&lt;/p&gt;
&lt;p&gt;I recommend taking a look &lt;a href=&quot;https://github.com/jaredcnance/FuzzySearch/commit/e01fd327ea988889b8878a5dbbd699e1c617a4ee&quot;&gt;at the commit&lt;/a&gt; to see the updated implementation using &lt;code class=&quot;language-text&quot;&gt;Span&lt;/code&gt; instead of &lt;code class=&quot;language-text&quot;&gt;.Substring&lt;/code&gt;. The significant change was from this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; str2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Substring&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;j &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; b &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; str1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Substring&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; cost &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;a &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; b &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;To this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; str2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AsSpan&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Slice&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;j &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; b &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; str1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AsSpan&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Slice&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; cost &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;a &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; b &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h3&gt;Benchmark results&lt;/h3&gt;
&lt;p&gt;In order to evaluate the efficacy of our changes, we need to re-run our benchmarks against the new implementations, comparing them against the old. To do this, we can temporarily expose the old methods and tell BenchmarkDotNet that it should be our baseline for comparison:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Benchmark&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;LevenshteinDistance&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; _levenshteinFuzzySearch&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ComputeSimilarity&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;String1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Value&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; String2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Benchmark&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Baseline &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;LevenshteinDistanceBaseline&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; _levenshteinFuzzySearch&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ComputeSimilarity_Baseline&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;String1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Value&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; String2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Now, running our benchmarks against the new and improved code gives us the following results:&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/benchmarks-3-d67778a610d7eea5e85879405457b2e3-9160a.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 26.953125%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAARlAAAEZQAGA43XUAAAAxklEQVQY042O1xKCMBBFASmjNOtPKCXBhOCg6Kj//0vXzWJ7cnw4c8tsNutkskUsNQKhEEmFUIwEtYJfaUK9cXaaaH+z7AXyTiJrCWNpWBPdYNrs4RWaF7l22fYPJvaK0l5o4NeGrwqlQVCNHf9adHALM1KSrw/UPX356b2K+qjskYkzcnlBKgYsSOdE/tUlzImxOaqP7HlOnlkz0lQOcGbiiJW6YU0kVGz0nfKVs9WYHr6GU1Lrp7xwQN5c4IseE2JGczY/AEtwj1hN9E60AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;benchmarks 3&quot;
        title=&quot;&quot;
        src=&quot;/static/benchmarks-3-d67778a610d7eea5e85879405457b2e3-fb8a0.png&quot;
        srcset=&quot;/static/benchmarks-3-d67778a610d7eea5e85879405457b2e3-1a291.png 148w,
/static/benchmarks-3-d67778a610d7eea5e85879405457b2e3-2bc4a.png 295w,
/static/benchmarks-3-d67778a610d7eea5e85879405457b2e3-fb8a0.png 590w,
/static/benchmarks-3-d67778a610d7eea5e85879405457b2e3-526de.png 885w,
/static/benchmarks-3-d67778a610d7eea5e85879405457b2e3-9160a.png 1024w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;This shows that across the board, execution time decreased approximately 77% and allocations decreased by 94%. So, what does that mean in terms of user response time? Well, let’s take another look at our application in Prefix.&lt;/p&gt;
&lt;h3&gt;Prefix and Profiler results&lt;/h3&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/prefix-2-9b144da31f8c0649b3a999749753c179-9160a.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 28.515625%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAARlAAAEZQAGA43XUAAABP0lEQVQY03WQWU/CUBBG+1NEURNlLVoF2tsWlS63axBaBAIoMer/fz/e1iXxwYeTbzKZOZOM5sRrRl6B6S0Q4ZKxStMv6qy4cjL6ImFgp+iKnhWji5hrV/VNSX+ywHiY43gxlj9HM8OSu3SDiFZU9Wz1gRU9Mc23ZMUrl2PJxa3k/HpK184wpqU6ktbCKq/smIGI1O6qPqjJbMN6/UY62xKrert5R+Zrsscd8+KFG7VoTHJ6SjxwAgw3+RI5ybdUoXJgJ+hWhBbLFfJ+hi8knh1xb0l8NewpMm9OaIZK9CXpipzWOKI9DGpat94f+rVw8UycL/GC5Jv0N2ePJcORS7Pn0FX/qiSXNwEnhqRphDQ6gkZrTKNtcqTyuGOhhYcP/P2Bu+WSSflDiVuUhPsd7SCoB890l1N9ouSCk+7/fAJZBNaA5MVKogAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;prefix 2&quot;
        title=&quot;&quot;
        src=&quot;/static/prefix-2-9b144da31f8c0649b3a999749753c179-fb8a0.png&quot;
        srcset=&quot;/static/prefix-2-9b144da31f8c0649b3a999749753c179-1a291.png 148w,
/static/prefix-2-9b144da31f8c0649b3a999749753c179-2bc4a.png 295w,
/static/prefix-2-9b144da31f8c0649b3a999749753c179-fb8a0.png 590w,
/static/prefix-2-9b144da31f8c0649b3a999749753c179-526de.png 885w,
/static/prefix-2-9b144da31f8c0649b3a999749753c179-9160a.png 1024w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;Here you can see both implementations running against the same dataset. We can see a slight improvement over the initial request, but what’s interesting is the 318 ms response time for subsequent requests. We’re now much closer to Nielson’s 0.1s target for perceived instantaneity on a fuzzy search across 5000 records.&lt;/p&gt;
&lt;p&gt;If we take a look at the profiler output for the new implementation, we can see how the breakdown has changed.&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/profiler-3-edc6feaba303de1b51fa7a80b876a922-9160a.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 32.421875%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAARlAAAEZQAGA43XUAAABE0lEQVQY02WQS07DMBRFuxGS0MZ2fnY+dpK2KZAygIoJO2A9LAAJJqz1cu1CKXRw9J5s6fjIi3FcYxhGbLYT5nkf9r4fTnTWQmsTEEIGlFQoVUZyuKaFyQsUPC9khkXb9eiItV6whjEtmsaibR2sG46Td86NaOoODQNejMNn5vAmO3zknEuD92uN19xiYUyHsjSoqjpMzel3L1askKxJUxmQgjvPdnmJ55XAIU7wGMV4uIpxiBI8+cKar3qB1s0fTN1SIi5Ykb4ocaskbpTClKYY4hhjEmPKFAu/hefoilIW/vzZCS/kHPhn90JglgJbyjZRhInzjg+Ewv91AQpTcaw6l/rCsayw591uufwVJgn2LP8C2DG40z5/dREAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;profiler 3&quot;
        title=&quot;&quot;
        src=&quot;/static/profiler-3-edc6feaba303de1b51fa7a80b876a922-fb8a0.png&quot;
        srcset=&quot;/static/profiler-3-edc6feaba303de1b51fa7a80b876a922-1a291.png 148w,
/static/profiler-3-edc6feaba303de1b51fa7a80b876a922-2bc4a.png 295w,
/static/profiler-3-edc6feaba303de1b51fa7a80b876a922-fb8a0.png 590w,
/static/profiler-3-edc6feaba303de1b51fa7a80b876a922-526de.png 885w,
/static/profiler-3-edc6feaba303de1b51fa7a80b876a922-9160a.png 1024w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;h3&gt;Common Performance Problems&lt;/h3&gt;
&lt;p&gt;Here is a short list of a few common application performance problems I’ve encountered in the past:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Unnecessary collection enumeration and allocation (&lt;code class=&quot;language-text&quot;&gt;.ToList()&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;String manipulation in loops&lt;/li&gt;
&lt;li&gt;Using &lt;code class=&quot;language-text&quot;&gt;string.Substring()&lt;/code&gt; instead of &lt;code class=&quot;language-text&quot;&gt;Span&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Using &lt;code class=&quot;language-text&quot;&gt;string.Format&lt;/code&gt; (or C# 6 interpolation via the &lt;code class=&quot;language-text&quot;&gt;$&lt;/code&gt; operator) instead of &lt;code class=&quot;language-text&quot;&gt;string.Concat&lt;/code&gt; for small operations&lt;/li&gt;
&lt;li&gt;Not using async for I/O operations that can be executed in parallel&lt;/li&gt;
&lt;li&gt;Wrapping synchronous operations in async wrappers and executing them synchronously. This results in the creation of unnecessary tasks and state machines.&lt;/li&gt;
&lt;li&gt;Using &lt;code class=&quot;language-text&quot;&gt;List&lt;/code&gt; instead of &lt;code class=&quot;language-text&quot;&gt;Dictionary&lt;/code&gt; for key/id-based access. Or more generalized: choosing improper collection types.&lt;/li&gt;
&lt;li&gt;Unnecessary boxing &lt;code class=&quot;language-text&quot;&gt;(var i = 0; object a = i; var j = (int)a;)&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Large lock blocks or locking types. Use locks on static instance variables as close as possible to the synchronous operation. Consider the use of ThreadStatic or LocalAsync.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Conclusion&lt;/h3&gt;
&lt;p&gt;At the end of the day, the quality of large-scale applications is limited by the quality of the processes that govern their development. Without proper pre-production processes, we will inevitably release poor-performing code to our users. Through the use of pre-production tooling such as Prefix and Retrace on staging environments, we can gain quick insights into the performance impact of changes. Once we have identified possible issues, we can follow the procedure outlined above to correct performance problems before they bring down critical systems.&lt;/p&gt;
&lt;p&gt;If you found this post helpful or if you have any questions, let me know in the comments!&lt;/p&gt;
&lt;h3&gt;Additional Resources&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://benchmarkdotnet.org/&quot;&gt;BenchmarkDotNet&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.microsoft.com/en-us/visualstudio/profiling/beginners-guide-to-performance-profiling&quot;&gt;Profile application performance in Visual Studio&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.jetbrains.com/dotmemory/&quot;&gt;dotMemory&lt;/a&gt; | &lt;a href=&quot;https://www.jetbrains.com/profiler/&quot;&gt;dotTrace&lt;/a&gt; from JetBrains&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/Microsoft/perfview&quot;&gt;Microsoft PerfView&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.writinghighperf.net/buy/&quot;&gt;Writing High-Performance .Net Code&lt;/a&gt; by &lt;a href=&quot;https://twitter.com/benmwatson&quot;&gt;Ben Watson&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.ageofascent.com/2017/11/05/perfromance-dotnet-core-2-corestart-conference/&quot;&gt;Corestart 2.0: What’s new for performance in .NET Core 2.0&lt;/a&gt; by &lt;a href=&quot;https://twitter.com/ben_a_adams&quot;&gt;Ben Adams&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[A Guide to Logging in Azure Functions]]></title><description><![CDATA[This is a cross-post from  stackify.com If you are thinking about using Azure Functions, at some point you will be confronted with the…]]></description><link>https://jaredcnance.github.io//logging-in-azure-functions/</link><guid isPermaLink="false">https://jaredcnance.github.io//logging-in-azure-functions/</guid><pubDate>Tue, 05 Dec 2017 00:00:00 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;This is a cross-post from &lt;a href=&quot;https://stackify.com/logging-azure-functions&quot;&gt;stackify.com&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;If you are thinking about using Azure Functions, at some point you will be confronted with the challenge of figuring out how application logging works.
Logging in Azure Functions has some unique challenges due to the stateless nature of the serverless execution model.
In this article, we will cover some basics about Azure Functions and provide instruction on how to write application logs.&lt;/p&gt;
&lt;p&gt;You can check out the final solution &lt;a href=&quot;https://github.com/jaredcnance/AzureFunctionsLogging&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Serverless 101&lt;/h2&gt;
&lt;p&gt;Azure Functions is one implementation of the serverless execution model.
Serverless compute platforms such as Azure Functions, AWS Lambda and Google Cloud Functions represent possibly the most significant change in how
application code is managed and executed since the rise of web applications.&lt;/p&gt;
&lt;p&gt;The idea is that we deploy our application code to a platform.
This platform bundles together the infrastructure and runtime framework responsible for hosting and invoking our application.
Technologies have existed that provide some of these features for web applications already (Azure App Service, Heroku, etc.).&lt;/p&gt;
&lt;p&gt;The main difference here is a common pattern for application development that is agnostic to how the application is invoked (HTTP request, timer, queue message, etc.).
Azure Functions supports many different types of triggers, not just HTTP requests.&lt;/p&gt;
&lt;h3&gt;Infinite scale&lt;/h3&gt;
&lt;p&gt;Possibly the primary highlight of serverless is the ability to quickly scale up and down based on the demand.
We are no longer paying for a set of VMs constantly running whether they are being fully utilized or not.
This allows us to improve our utilization efficiency, paying only for what is used.&lt;/p&gt;
&lt;h3&gt;Stateless&lt;/h3&gt;
&lt;p&gt;Serverless applications are&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;run in stateless compute containers that are event-triggered, ephemeral
(may only last for one invocation), and fully managed by a 3rd party”
&lt;a href=&quot;https://martinfowler.com/articles/serverless.html&quot;&gt;Fowler&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Note that .Net Azure Functions are only semi-stateless.
For performance reasons, there is no app domain isolation between functions within the same function app.
This means statics are persisted across invocations until the app domain is unloaded.&lt;/p&gt;
&lt;h3&gt;Ultimate simplicity (sometimes)&lt;/h3&gt;
&lt;p&gt;Serverless solutions such as Azure Functions are growing in popularity because of their promised simplicity.
You can just write all your code in your browser, right?
I’m being facetious here — this strategy is unlikely to scale well for applications of even moderate complexity.
However, while more things have been built into the framework and we can be concerned with less, this technology
is very young and concerns that have been historically trivial with “first-class” applications require a bit more work.
A good example of this is application logging.&lt;/p&gt;
&lt;h2&gt;History of Logging in Azure Functions&lt;/h2&gt;
&lt;p&gt;The first logging mechanism available in Functions was through the &lt;code class=&quot;language-text&quot;&gt;TraceWriter&lt;/code&gt; class. You can accept a &lt;code class=&quot;language-text&quot;&gt;TraceWriter&lt;/code&gt; instance as a parameter in your function method.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Message message&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; TraceWriter log&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Function invoked.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;The &lt;code class=&quot;language-text&quot;&gt;TraceWriter&lt;/code&gt; will make logs available through the “Invocation log” in the portal and the command line when debugging with &lt;a href=&quot;https://github.com/Azure/azure-functions-cli&quot;&gt;func.exe&lt;/a&gt;.
You can also view these logs in Kudu or as the raw data stored in Table Storage under the storage account configured using the &lt;code class=&quot;language-text&quot;&gt;AzureWebJobsStorage&lt;/code&gt; setting.&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/logs-1-f2c4d09bba377dab87d072e34f8d171e-9160a.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 66.2109375%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACPElEQVQ4y3VSaY/aQAzN//8x/Y4q7YdKuw1HEnJOAiEcIVxLAwuEhBy8esxuuqu2lp5GY3ve2M9WzFmKrKiwPxU4ZjeUVYOyfuBW1ZC2SjOEmxPO+SOvKGtU7zmcT5B2v9+hfFMjrFcJxDiCF4Qoilsb/Eh04iOe9BC73ZZI7qibhuMSzac8JpzvL2iaGlciyvOCgvR7c28rkHbMSmwPGaqq4juFifTOubKLkjt5fKAcDik221dk1yuykpwUquuKq5AfyQfpOQepgtutxCJeYr3Z4Vea4l+meP4Inh9gOptjtoixJfJlskE4iWA7HoLRGCadh+MbVxgnK7ydTti97rHdvba4XDLkRQFF+D4Gmo7eQOPTEwLjyYTIHGi6gaFpwTCGmM0X3FKe54x4mcAVAcJoRh3uGKv1hir0PGiaBp3IhvQwCHxEUQhXEtInpmnCIOJkuWQZZNvSrkxc0P2GglCWD7/yIibo6C46moPvQwF1kkBb7vHj3f9kj9AxPPjbFDW1fD5fHoTXnHWXxFl2bbdD8cYTaLbL0B0Bl+7BdAbbH5PPg+EKRkItSQ2lTs2ntWnXh3x1XUOxbBvdbo/R7w8ghEe6jGGRdqraxYDa1kiOzXrd7tr/IEkV23HRJaJub4A+PRQ0cTlhy7LZr5Ouclgxacg72PxZ4s/WEsq1kJM0LQuy2tEoxDSa87Sl33FdPuP4b8IPfCGUyc8/VYZKbbue4AqN4RDPLyr61LL0LxYLfih1anjpv0L6JX4DVNvM3oM/C74AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;logs 1&quot;
        title=&quot;&quot;
        src=&quot;/static/logs-1-f2c4d09bba377dab87d072e34f8d171e-fb8a0.png&quot;
        srcset=&quot;/static/logs-1-f2c4d09bba377dab87d072e34f8d171e-1a291.png 148w,
/static/logs-1-f2c4d09bba377dab87d072e34f8d171e-2bc4a.png 295w,
/static/logs-1-f2c4d09bba377dab87d072e34f8d171e-fb8a0.png 590w,
/static/logs-1-f2c4d09bba377dab87d072e34f8d171e-526de.png 885w,
/static/logs-1-f2c4d09bba377dab87d072e34f8d171e-9160a.png 1024w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;h2&gt;Current State&lt;/h2&gt;
&lt;p&gt;The problem with &lt;code class=&quot;language-text&quot;&gt;TraceWriter&lt;/code&gt; is that it is only useful for applications being executed by the Azure Functions runtime.
So we don’t want all of the classes in our application to be tightly coupled to &lt;code class=&quot;language-text&quot;&gt;TraceWriter&lt;/code&gt;.
We want to have the ability to reuse the classes in other applications such as web or console apps.&lt;/p&gt;
&lt;p&gt;The best that we get is a minor abstraction of &lt;code class=&quot;language-text&quot;&gt;TraceWriter&lt;/code&gt; in the form of the &lt;code class=&quot;language-text&quot;&gt;ILogger&lt;/code&gt; interface.
You may recognize this as the interface introduced in ASP.NET Core through the Microsoft.Extensions.Logging.Abstractions package.
An example function using the ILogger interface looks like:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Message message&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ILogger log&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;LogInformation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Function invoked.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Unfortunately, &lt;a href=&quot;https://social.msdn.microsoft.com/Forums/en-US/10f139b2-8964-4487-b11f-6c74c891eeb5/using-custom-ilogger-in-azure-functions?forum=AzureFunctions&quot;&gt;we are not provided any mechanism&lt;/a&gt;
to access the &lt;code class=&quot;language-text&quot;&gt;ILoggerFactory&lt;/code&gt; instance that creates the loggers.
This means we need to create an implementation of the &lt;a href=&quot;https://dotnetcodr.com/2013/04/25/design-patterns-and-practices-in-net-the-adapter-pattern/&quot;&gt;Adapter pattern&lt;/a&gt;
so that our service code does not depend on the concrete &lt;code class=&quot;language-text&quot;&gt;TraceWriter&lt;/code&gt; type.&lt;/p&gt;
&lt;h2&gt;log4net&lt;/h2&gt;
&lt;p&gt;See the full example implementation here. Some of the code below has been simplified to improve readability.&lt;/p&gt;
&lt;p&gt;Azure Functions does not load configuration from an app.config or web.config file. So the only way that we have to
specify our log4net configuration is through a &lt;a href=&quot;https://logging.apache.org/log4net/release/manual/configuration.html#dot-config&quot;&gt;separate config file&lt;/a&gt;,
as shown by an example in the &lt;a href=&quot;https://github.com/jaredcnance/AzureFunctionsLogging/blob/master/AzureFunctionsLogging/Log4net/Log4Net.config&quot;&gt;repository&lt;/a&gt;.
Now you can load the configuration file:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;string&lt;/span&gt; _functionDirectory&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; Task&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;HttpResponseMessage&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;HttpRequestMessage req&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; TraceWriter log&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ExecutionContext context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;IsNullOrEmpty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_functionDirectory&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    _functionDirectory &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;FunctionDirectory&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; finfo &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;FileInfo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;$&lt;span class=&quot;token string&quot;&gt;&quot;{_functionDirectory}\\Log4Net.config&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    log4net&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;XmlConfigurator&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ConfigureAndWatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;finfo&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;We first get the function directory from the &lt;code class=&quot;language-text&quot;&gt;ExecutionContext&lt;/code&gt; and then we load the configuration from our file.
As discussed above, functions are only semi-stateless so once we have loaded the configuration, there is no need to re-read the file until the app domain gets reloaded.&lt;/p&gt;
&lt;p&gt;Now create an adapter for the logging interface of our choice.
The adapter interface can be Microsoft’s ILogger, or log4net’s ILog, or whatever interface you have chosen for the rest of your stack.
An example implementation using the log4net ILog interface &lt;a href=&quot;https://github.com/jaredcnance/AzureFunctionsLogging/blob/master/AzureFunctionsLogging/Log4net/ILogTraceWriterAdapter.cs&quot;&gt;is here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;You may notice that we need to have a type definition to create our logger.
The logging adapter needs to know the type that will be receiving the adapter instance.
In exceptionally simple functions, you can keep it simple and manually construct your dependency graph on invocation:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; logger &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ILogTraceWriterAdapter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Function&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; log&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; processor &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;FunctionProcessor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;logger&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
processor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Process&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;body&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h3&gt;Injecting the Logger&lt;/h3&gt;
&lt;p&gt;However, for more complex applications, you can use &lt;a href=&quot;http://stackify.com/net-core-dependency-injection/&quot;&gt;dependency injection&lt;/a&gt; (DI) to handle injection of your logger.
Since the Azure Functions runtime &lt;a href=&quot;https://github.com/Azure/azure-webjobs-sdk-script/blob/bac0a62e9a4f844c95dd2ffbbd5702cd5cab30d0/src/WebJobs.Script.WebHost/WebJobs.Script.WebHost.csproj#L35&quot;&gt;ships with Autofac&lt;/a&gt;
included, it makes sense for us to use that as the DI framework.
Autofac provides dynamic component resolution hooks so that we can provide the type definition to the consuming logger.
&lt;a href=&quot;https://github.com/jaredcnance/AzureFunctionsLogging/blob/master/AzureFunctionsLogging/Log4net/TraceWriterLoggingModule.cs&quot;&gt;In the example&lt;/a&gt;, I do the following:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;OnComponentPreparing&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; sender&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; PreparingEventArgs e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Parameters &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Parameters&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Union&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ResolvedParameter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;p&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; p&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ParameterType &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ILog&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;p&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ILogTraceWriterAdapter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;p&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Member&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;DeclaringType&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method function&quot;&gt;Resolve&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;TraceWriter&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Any service that is resolved from the Autofac container and requires an implementation of &lt;code class=&quot;language-text&quot;&gt;ILog&lt;/code&gt; will receive an instance of &lt;code class=&quot;language-text&quot;&gt;ILogTraceWriterAdapter&lt;/code&gt;.
Autofac constructs the adapter using the requesting type and registered &lt;code class=&quot;language-text&quot;&gt;TraceWriter&lt;/code&gt; instance.
We also need to create a container and register our instances to that container:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; builder &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ContainerBuilder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
builder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method function&quot;&gt;RegisterModule&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;TraceWriterLoggingModule&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
builder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method function&quot;&gt;RegisterType&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;FunctionProcessor&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; container &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; builder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Now add the &lt;code class=&quot;language-text&quot;&gt;TraceWriter&lt;/code&gt; to the container by &lt;a href=&quot;https://github.com/jaredcnance/AzureFunctionsLogging/blob/master/AzureFunctionsLogging/Log4net/Function.cs#L23-L27&quot;&gt;creating a scope&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; scope &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; _serviceProvider&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;BeginLifetimeScope&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;b &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;RegisterInstance&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;log&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; processor &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; scope&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method function&quot;&gt;Resolve&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;FunctionProcessor&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  processor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Process&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;body&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h2&gt;Serilog&lt;/h2&gt;
&lt;p&gt;Luckily, in the case of Serilog, there is already a sink
(&lt;a href=&quot;https://github.com/StarRez/Serilog.Sinks.AzureWebJobsTraceWriter&quot;&gt;Serilog.Sinks.AzureWebJobsTraceWriter&lt;/a&gt;) built exactly for this purpose.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;using&lt;/span&gt; Serilog&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Sinks&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;AzureWebJobsTraceWriter&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; log &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;LoggerConfiguration&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WriteTo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;TraceWriter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;traceWriter&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;CreateLogger&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Warning&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;This will be written to the TraceWriter&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;You can then inject the log instance into the scope in the same way that I demonstrated above with log4net.&lt;/p&gt;
&lt;h2&gt;Other Providers&lt;/h2&gt;
&lt;p&gt;While there are many other logging providers that are not covered here,
I believe that I have equipped you with the tools that you will need to implement logging for the other providers.&lt;/p&gt;
&lt;h2&gt;Stackify&lt;/h2&gt;
&lt;p&gt;If you would like to ship your Azure Functions logs to Stackify (and we hope you do!), we recommend using one of our extensions to the major logging frameworks.
Also, the &lt;a href=&quot;https://github.com/jaredcnance/AzureFunctionsLogging/blob/dee58c441216778a2ed205d1aebcaeb9334708bd/AzureFunctionsLogging/&quot;&gt;demo repository&lt;/a&gt;
provides examples for shipping log4net and Serilog logs to Stackify.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Tip: When you are hacking around with a new app and trying to send logs to Stackify, try
filtering down to the function app and use the log tailing feature so you can see the logs as they are processed by Stackify.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;Configuration&lt;/h3&gt;
&lt;p&gt;I used the &lt;a href=&quot;https://github.com/jaredcnance/AzureFunctionsLogging/blob/dee58c441216778a2ed205d1aebcaeb9334708bd/AzureFunctionsLogging/AzureFunctionsLogging.csproj#L12-L13&quot;&gt;Microsoft.Extenstions.Configuration&lt;/a&gt;
packages to &lt;a href=&quot;https://github.com/jaredcnance/AzureFunctionsLogging/blob/dee58c441216778a2ed205d1aebcaeb9334708bd/AzureFunctionsLogging/Log4net/ServiceProvider.cs#L10-L16&quot;&gt;load configuration&lt;/a&gt;
from environment variables and pass them to the &lt;a href=&quot;https://github.com/stackify/stackify-api-dotnet&quot;&gt;Stackify library&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;readonly&lt;/span&gt; IConfigurationRoot _config &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ConfigurationBuilder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddEnvironmentVariables&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  _config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ConfigureStackify&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Configuration from &lt;code class=&quot;language-text&quot;&gt;local.settings.json&lt;/code&gt; will be available during development. For deployed functions, you can apply settings through the portal:&lt;/p&gt;
&lt;p&gt;Configuration from local.settings.json will be available during development. For deployed functions, you can apply settings through the portal.&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/settings-1-9a8903f0f3def743b6b0a77a5f370a4b-58f95.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 56.16264294790343%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAA90lEQVQoz52T246EIBBE/f8/1MQXZ3WNIncYb1AD7brzqpIcoE0oiupYtG2LqqpQ1zWa5pVoUJYluq5DHjHGWxScc/R9j2maIIQghmGg+hS8M4pzs4dAhJBvAkKatn2nOtD3axR5UkpjnDgmLgjOJViq3/NMDkk0XiM5jLDWHUJCQipFq3XucPrn+iqFkwukNNDGQOm8Wnj/xrwsX3d3BMfGYhwEVBIUUsEkt2cz7oqRIPtxYIMkQZmyzM/9ZhceOHxZsFH9C0pl4Lw/Ov7kyfzXgzOZstOpORbO2ZSlxrpuzzLMh7Rbwc0C4zcwNcPPO+UYbv4lmQ8f8F6BWxRh0wAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;settings 1&quot;
        title=&quot;&quot;
        src=&quot;/static/settings-1-9a8903f0f3def743b6b0a77a5f370a4b-fb8a0.png&quot;
        srcset=&quot;/static/settings-1-9a8903f0f3def743b6b0a77a5f370a4b-1a291.png 148w,
/static/settings-1-9a8903f0f3def743b6b0a77a5f370a4b-2bc4a.png 295w,
/static/settings-1-9a8903f0f3def743b6b0a77a5f370a4b-fb8a0.png 590w,
/static/settings-1-9a8903f0f3def743b6b0a77a5f370a4b-58f95.png 787w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;h2&gt;Future&lt;/h2&gt;
&lt;p&gt;Whatever solution that you choose (at this time) will contain some temporary stopgap measure(s) until there is a formalized solution for dependency injection.
This may involve some effort to reuse prior art introduced in ASP.NET Core. Until then, we’ll be tracking the progress at
&lt;a href=&quot;https://github.com/Azure/azure-webjobs-sdk-script/issues/1579&quot;&gt;Azure/azure-webjobs-sdk-script#1579&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The best advice that I can give at this point is to ensure that your service code is dependent on the &lt;code class=&quot;language-text&quot;&gt;ILogger&lt;/code&gt; interface or some other abstraction that you may define,
but not &lt;code class=&quot;language-text&quot;&gt;TraceWriter&lt;/code&gt; . Eventually we should be able to pull back the adapters introduced above and use a proper DI-based logging solution.&lt;/p&gt;
&lt;h2&gt;Possible Issues&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;“Exception while executing function: Functions.log4net -&gt; Exception binding parameter ‘log’ -&gt; No value was provided for parameter ‘log’.”&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;This can be caused by a version mismatch.
The function runtime is bringing in Microsoft.Extensions.Logging at v1.1.1
and you may be referencing a different version.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;You may run into an issue accepting ILogger as a function method parameter
that causes log messages to not be displayed in the console when running the
function locally using func.exe. As of the writing of this post, there has yet
to be any resolution &lt;a href=&quot;https://github.com/Azure/azure-functions-cli/issues/130&quot;&gt;from the Azure Functions team&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Depending on which version of func.exe you are running,
you may run into issues trying to use the pre-release (3.0.0-&lt;em&gt;)
Microsoft.Azure.WebJobs.&lt;/em&gt; packages.
For example, I’m running Azure Functions Core Tools (1.0.4)
and Function Runtime Version: 1.0.11232.0, which references
Microsoft.Azure.WebJobs 2.1.0. Since &lt;a href=&quot;https://github.com/Azure/azure-webjobs-sdk-script/issues/992&quot;&gt;binding redirects are still unsupported&lt;/a&gt;,
this means there will be runtime type errors when trying to reference types in the pre-release version.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Resources&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/Azure/azure-webjobs-sdk-script/wiki/Precompiled-functions&quot;&gt;Pre-compiled Azure functions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://stackify.com/net-core-dependency-injection/&quot;&gt;Dependency injection&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;GitHub Issues To Watch&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/Azure/azure-webjobs-sdk-script/issues/992&quot;&gt;Binding redirect support&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/Azure/azure-webjobs-sdk-script/issues/1579&quot;&gt;Allow custom dependency injection&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/Azure/azure-functions-cli/issues/130&quot;&gt;Logging written to ILogger does not appear in the CLI&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/Azure/azure-webjobs-sdk/issues/1390&quot;&gt;In-memory integration testing of Azure functions&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[.Net Core Dependency Injection]]></title><description><![CDATA[This is a cross-post from  stackify.com What is Dependency Injection? Dependency Injection  (DI) is a pattern that can help developers…]]></description><link>https://jaredcnance.github.io//dotnet-core-dependency-injection/</link><guid isPermaLink="false">https://jaredcnance.github.io//dotnet-core-dependency-injection/</guid><pubDate>Mon, 16 Oct 2017 00:00:00 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;This is a cross-post from &lt;a href=&quot;https://stackify.com/net-core-dependency-injection&quot;&gt;stackify.com&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;What is Dependency Injection?&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.martinfowler.com/articles/injection.html&quot;&gt;Dependency Injection&lt;/a&gt; (DI) is a pattern that can help developers decouple the different pieces of their applications. It provides a mechanism for the construction of dependency graphs independent of the class definitions. Throughout this article, I will be focusing on &lt;a href=&quot;https://en.wikipedia.org/wiki/Dependency_injection#Constructor_injection&quot;&gt;constructor injection&lt;/a&gt; where dependencies are provided to consumers through their constructors. Consider the following classes:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Bar&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; IBar &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;readonly&lt;/span&gt; IBar _bar&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;IBar bar&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    _bar &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; bar&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;In this example, &lt;code class=&quot;language-text&quot;&gt;Foo&lt;/code&gt; depends on &lt;code class=&quot;language-text&quot;&gt;IBar&lt;/code&gt; and somewhere we’ll have to construct an instance of Foo and specify that it depends on the implementation &lt;code class=&quot;language-text&quot;&gt;Bar&lt;/code&gt; like so:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; bar &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; foo &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;bar&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;The problem with this is two-fold. Firstly, it violates the &lt;a href=&quot;https://en.wikipedia.org/wiki/Dependency_inversion_principle&quot;&gt;Dependency Inversion Principle&lt;/a&gt; because the consuming class &lt;a href=&quot;http://deviq.com/explicit-dependencies-principle/&quot;&gt;implicitly depends&lt;/a&gt; on the concrete types &lt;code class=&quot;language-text&quot;&gt;Bar&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;Foo&lt;/code&gt;. Secondly, it results in a scattered definition of the dependency graph and can make unit testing very difficult.&lt;/p&gt;
&lt;p&gt;The &lt;a href=&quot;http://blog.ploeh.dk/2011/07/28/CompositionRoot/&quot;&gt;Composition Root&lt;/a&gt; pattern states that the entire dependency graph should be composed in a single location “as close as possible to the application’s entry point”. This could get pretty messy without the assistance of a framework. DI frameworks provide a mechanism, often referred to as an Inversion of Control (IoC) Container, for offloading the instantiation, injection, and lifetime management of dependencies to the framework. You invert the control of component instantiation from the consumers to the container, hence “Inversion of Control”.&lt;/p&gt;
&lt;p&gt;To do this, you simply register services with a container, and then you can load the top level service. The framework will inject all child services for you. A simple example, based on the class definitions above, might look like:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;container&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method function&quot;&gt;Register&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Bar&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method function&quot;&gt;As&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;IBar&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
container&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method function&quot;&gt;Register&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Foo&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// per the Composition Root pattern, this _should_ be the only lookup on the container&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; foo &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; container&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method function&quot;&gt;Get&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;Foo&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h2&gt;Dependency Injection in ASP.Net Core&lt;/h2&gt;
&lt;p&gt;Prior to &lt;a href=&quot;http://stackify.com/net-core-2-0-changes/&quot;&gt;.Net Core&lt;/a&gt;, the only way to get DI in your applications was through the use of a framework such as &lt;a href=&quot;https://autofac.org/&quot;&gt;Autofac&lt;/a&gt;, &lt;a href=&quot;http://www.ninject.org/&quot;&gt;Ninject&lt;/a&gt;, &lt;a href=&quot;https://structuremap.github.io/&quot;&gt;StructureMap&lt;/a&gt; and &lt;a href=&quot;https://github.com/danielpalme/IocPerformance&quot;&gt;many others&lt;/a&gt;. However, DI is treated as a &lt;a href=&quot;https://docs.microsoft.com/en-us/aspnet/core/fundamentals/dependency-injection&quot;&gt;first-class citizen&lt;/a&gt; in ASP.Net Core. You can configure your container in your &lt;code class=&quot;language-text&quot;&gt;Startup.ConfigureServices&lt;/code&gt; method:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Startup&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ConfigureServices&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;IServiceCollection services&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    services&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method function&quot;&gt;AddTransient&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;IArticleService&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ArticleService&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;When a request gets routed to your controller, it will be &lt;a href=&quot;https://github.com/aspnet/Mvc/blob/eeac99985a61e75ca48e620f0371e16df018d6d7/src/Microsoft.AspNetCore.Mvc.Core/Controllers/ServiceBasedControllerActivator.cs#L16-L26&quot;&gt;resolved from the container&lt;/a&gt; along with all its dependencies:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ArticlesController&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Controller &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;readonly&lt;/span&gt; IArticleService _articleService&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ArticlesController&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;IArticleService articleService&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    _articleService &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; articleService&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;HttpGet&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;{id}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; Task&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;IActionResult&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;GetAsync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; article &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; _articleService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GetAsync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;article &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;NotFound&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;article&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h3&gt;Dependency Lifetimes&lt;/h3&gt;
&lt;p&gt;At registration time, dependencies require a lifetime definition. The service lifetime defines the conditions under which a new service instance will be created. Below are the lifetimes defined by the ASP.Net DI framework. The terminology may be different if you choose to use a different framework.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Transient&lt;/strong&gt; – Created every time they are requested&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Scoped&lt;/strong&gt; – Created once per scope. Most of the time, scope refers to a web request. But this can also be used for any unit of work, such as the execution of an Azure Function.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Singleton&lt;/strong&gt; – Created only for the first request. If a particular instance is specified at registration time, this instance will be provided to all consumers of the registration type.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Using Different Providers&lt;/h3&gt;
&lt;p&gt;If you would like to use a more mature DI framework, you can do so as long as they provide an &lt;a href=&quot;https://github.com/dotnet/corefx/blob/c6dbe361680efd21a20fdb8def01936b1031011c/src/System.ComponentModel/src/System/IServiceProvider.cs#L7-L10&quot;&gt;IServiceProvider&lt;/a&gt; implementation. If they don’t provide one, it is a very &lt;a href=&quot;https://github.com/dotnet/corefx/blob/c6dbe361680efd21a20fdb8def01936b1031011c/src/System.ComponentModel/src/System/IServiceProvider.cs#L7-L10&quot;&gt;simple interface&lt;/a&gt; that you should be able to implement yourself. You would just return an instance of the container in your ConfigureServices method. Here is an example using &lt;a href=&quot;https://www.nuget.org/packages/Autofac/4.6.1&quot;&gt;Autofac&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Startup&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; IServiceProvider &lt;span class=&quot;token function&quot;&gt;ConfigureServices&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;IServiceCollection services&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// setup the Autofac container&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; builder &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ContainerBuilder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    builder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Populate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;services&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    builder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method function&quot;&gt;RegisterType&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;ArticleService&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method function&quot;&gt;As&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;IArticleService&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; container &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; builder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// return the IServiceProvider implementation&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AutofacServiceProvider&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;container&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h3&gt;Generics&lt;/h3&gt;
&lt;p&gt;Dependency injection can get really interesting when you start working with generics. Most DI providers allow you to register &lt;a href=&quot;https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/language-specification/types&quot;&gt;open generic types&lt;/a&gt; that will have their generic arguments set based on the requested generic type arguments. A great example of this is Microsoft’s new logging framework (Microsoft.Extensions.Logging). If you look &lt;a href=&quot;https://github.com/aspnet/Logging/blob/af314d54058389c8685dbaeb360c9aa9caea0af5/src/Microsoft.Extensions.Logging/LoggingServiceCollectionExtensions.cs#L42&quot;&gt;under the hood&lt;/a&gt; you can see how they inject the open generic &lt;code class=&quot;language-text&quot;&gt;ILogger&amp;lt;&amp;gt;&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;services&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;TryAdd&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ServiceDescriptor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Singleton&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ILogger&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Logger&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;This allows you to depend on the generic &lt;code class=&quot;language-text&quot;&gt;ILogger&amp;lt;&amp;gt;&lt;/code&gt; like so:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ILogger&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Foo&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; logger&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;LogInformation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Constructed!!!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Another common use case is the &lt;a href=&quot;https://cpratt.co/truly-generic-repository/&quot;&gt;Generic Repository Pattern&lt;/a&gt;. Some consider this an &lt;a href=&quot;https://www.infoworld.com/article/3117713/application-development/design-patterns-that-i-often-avoid-repository-pattern.html&quot;&gt;anti-pattern&lt;/a&gt; when used with an ORM like Entity Framework because it already implements the Repository Pattern. But, if you’re unfamiliar with DI and generics, I think it provides an easy entry point.&lt;/p&gt;
&lt;p&gt;Open generic injection also provides a great mechanism for libraries (such as &lt;a href=&quot;https://github.com/json-api-dotnet/JsonApiDotNetCore&quot;&gt;JsonApiDotNetCore&lt;/a&gt;) to offer default behaviors with easy extensibility for applications. Suppose a framework provides an out-of-the-box, implementation of the generic repository pattern. It may have an interface that looks like this, implemented by a &lt;code class=&quot;language-text&quot;&gt;GenericRepository&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;IRepository&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;T&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;where&lt;/span&gt; T &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; IIdentifiable &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   T &lt;span class=&quot;token function&quot;&gt;Get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;The library would provide some &lt;code class=&quot;language-text&quot;&gt;IServiceCollection&lt;/code&gt; extension method like:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;AddDefaultRepositories&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt; IServiceCollection services&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  services&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;TryAdd&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ServiceDescriptor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Scoped&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;IRepository&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;GenericRepository&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;And the default behavior could be supplemented by the application on a per resource basis by injecting a more specific type:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;services&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;AddScoped&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;IRepository&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Foo&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; FooRepository&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;And of course &lt;code class=&quot;language-text&quot;&gt;FooRepository&lt;/code&gt; can inherit from &lt;code class=&quot;language-text&quot;&gt;GenericRepository&amp;lt;&amp;gt;&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;FooRepository&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; GenericRepository&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Foo&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  Foo &lt;span class=&quot;token function&quot;&gt;Get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; foo &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// ...authorization of resources or any other application concerns can go here&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; foo&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h2&gt;Beyond the Web&lt;/h2&gt;
&lt;p&gt;The ASP.Net team has separated their DI framework from the ASP.Net packages into &lt;a href=&quot;https://www.nuget.org/packages/Microsoft.Extensions.DependencyInjection/&quot;&gt;Microsoft.Extensions.DependencyInjection&lt;/a&gt;. What this means is that you are not limited to web apps and can leverage these new libraries in event-driven apps (such as Azure Functions and AWS Lambda) or in thread loop apps. All you need to do is:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Install the framework NuGet package:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Install-Package Microsoft.Extensions.DependencyInjection&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;or&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;dotnet add package Microsoft.Extensions.DependencyInjection&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;Register your dependencies on a static container:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; serviceCollection &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ServiceCollection&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
serviceCollection&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method function&quot;&gt;AddScoped&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;IEmailSender&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; AuthMessageSender&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
serviceCollection&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method function&quot;&gt;AddScoped&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;AzureFunctionEventProcessor&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; IEventProcessor&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
Container &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; serviceCollection&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;BuildServiceProvider&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;Define the lifetime scope (if applicable) and resolve your top level dependency:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; serviceScopeFactory &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Container&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method function&quot;&gt;GetRequiredService&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;IServiceScopeFactory&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; scope &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; serviceScopeFactory&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;CreateScope&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; processor &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; scope&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ServiceProvider&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method function&quot;&gt;GetService&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;IEventProcessor&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  processor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Handle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;theEvent&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/aspnet/DependencyInjection/blob/06e2de235ce5b27b425e823d9dcbd045811ba48e/src/DI/ServiceLookup/ServiceProviderEngine.cs#L26&quot;&gt;Under the hood&lt;/a&gt;, the call to &lt;code class=&quot;language-text&quot;&gt;.BuildServiceProvider()&lt;/code&gt; will inject an &lt;a href=&quot;https://github.com/aspnet/DependencyInjection/blob/d5e5aa703297b164b21ba4ad3fdff81c854ce009/src/DI.Abstractions/IServiceScopeFactory.cs#L10&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;IServiceScopeFactory&lt;/code&gt;&lt;/a&gt;. You can load this service and define a scope so you can use properly scoped services.&lt;/p&gt;
&lt;h3&gt;Disposable Services&lt;/h3&gt;
&lt;p&gt;If a registered service implements &lt;code class=&quot;language-text&quot;&gt;IDisposable&lt;/code&gt; it will be disposed of when the containing scope is disposed. You can see how this is done here. For this reason, it is important to always resolve services from a scope and not the root container, as described above. If you resolve &lt;code class=&quot;language-text&quot;&gt;IDisposable&lt;/code&gt;s from the root container, you may create a memory leak since these services will not be disposed of until the container gets disposed.&lt;/p&gt;
&lt;h3&gt;Dynamic Service Resolution&lt;/h3&gt;
&lt;p&gt;Some DI providers provide resolution time hooks that allow you to make runtime decisions about dependency injection. For example, Autofac provides an &lt;a href=&quot;https://autofac.org/apidoc/html/DB09DDBB.htm&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;AttachToComponentRegistration&lt;/code&gt;&lt;/a&gt; method that can be used to make runtime decisions. At Stackify, we used this with &lt;a href=&quot;http://stackify.com/azure-functions-performance-monitoring-retrace/&quot;&gt;Azure Functions&lt;/a&gt; to wrap the &lt;a href=&quot;https://docs.microsoft.com/en-us/azure/azure-functions/functions-reference-csharp#logging&quot;&gt;TraceWriter&lt;/a&gt; (before they &lt;a href=&quot;https://github.com/Azure/Azure-Functions/issues/293&quot;&gt;supported the ILogger interface&lt;/a&gt;) behind a facade. This facade passed the logging method calls to the scoped &lt;code class=&quot;language-text&quot;&gt;TraceWriter&lt;/code&gt; instance as well as our log4net logger. To do this, we register the instance of the &lt;code class=&quot;language-text&quot;&gt;TraceWriter&lt;/code&gt; when we begin the lifetime scope:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; scope &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ServiceProvider&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;BeginLifetimeScope&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;b &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;RegisterInstance&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;traceWriter&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;I’ve &lt;a href=&quot;https://gist.github.com/jaredcnance/45f5e7d367a02375c588087160e8f126&quot;&gt;created a gist here&lt;/a&gt; that you can reference if you’d like to see the rest of the implementation.&lt;/p&gt;
&lt;h3&gt;When Not To Use IoC Containers&lt;/h3&gt;
&lt;p&gt;In general, IoC containers are an application concern. What this means is library and framework authors should think carefully about whether or not it is really necessary to create an IoC container within the package itself. An example of one that does this is the AspNetCore.Mvc framework packages. However, this framework is intended to manage the life of the application itself. This is very different than say a logging framework.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Dependency Injection describes the pattern of passing dependencies to consuming services at instantiation. DI frameworks provide IoC containers that allow developers to offload control of this process to the framework. This lets us decouple our modules from their concrete dependencies, improving &lt;a href=&quot;http://stackify.com/fundamentals-web-application-performance-testing/&quot;&gt;testability&lt;/a&gt; and extensibility of our applications.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Note
All of the source code links used in this article are permalinks to the code on the default repository branches. These links should be used as a reference and not as the current state of the underlying implementations or APIs since these are subject to change at any time&lt;/p&gt;
&lt;/blockquote&gt;</content:encoded></item><item><title><![CDATA[TypeScript vs JavaScript]]></title><description><![CDATA[This is a cross-post from  stackify.com TypeScript (TS) and JavaScript are two widely known languages in the development world, but what are…]]></description><link>https://jaredcnance.github.io//typescript-vs-javascript/</link><guid isPermaLink="false">https://jaredcnance.github.io//typescript-vs-javascript/</guid><pubDate>Wed, 20 Sep 2017 00:00:00 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;This is a cross-post from &lt;a href=&quot;https://stackify.com/typescript-vs-javascript-migrate/&quot;&gt;stackify.com&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;TypeScript (TS) and JavaScript are two widely known languages in the development world, but what are the differences and what use cases are better suited for one over the other? In this post, we’ll compare the two languages, how they relate to one another, discuss their primary differences, and outline the benefits of each.&lt;/p&gt;
&lt;h3&gt;Defining TypeScript&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/JavaScript&quot;&gt;JavaScript&lt;/a&gt; is a dynamic, weakly-typed scripting language built for the web. It enables developers to add interactive functionality to their web pages without requiring unnecessary server-side processing. During &lt;a href=&quot;https://html.spec.whatwg.org/multipage/scripting.html#script&quot;&gt;HTML parsing&lt;/a&gt;, script files are downloaded and executed within the user’s browser rather than on your application server.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.typescriptlang.org/&quot;&gt;TypeScript&lt;/a&gt; is an &lt;a href=&quot;https://github.com/Microsoft/TypeScript&quot;&gt;open source&lt;/a&gt; syntactic superset of JavaScript that uses a &lt;a href=&quot;https://www.npmjs.com/package/typescript-compiler&quot;&gt;compiler&lt;/a&gt; to produce JavaScript (EcmaScript 3+). TypeScript offers type annotations which provide optional, static type checking at compile time. Since TypeScript is a superset of JavaScript, all JavaScript is syntactically valid TypeScript. However, that does not mean all JavaScript can actually be processed by the TypeScript compiler:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;a&apos;&lt;/span&gt;
a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// throws: error TS2322: Type &apos;1&apos; is not assignable to type &apos;string&apos;.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h3&gt;Benefits of TypeScript&lt;/h3&gt;
&lt;h4&gt;Type Annotations&lt;/h4&gt;
&lt;p&gt;TypeScript &lt;a href=&quot;https://github.com/Microsoft/TypeScript/wiki/TypeScript-Design-Goals&quot;&gt;was created to&lt;/a&gt; “statically identify constructs that are likely to be errors”. This allows us to make safe assumptions about state during execution. Let’s compare the following JavaScript and TypeScript functions:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// JavaScript&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getPassword&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;clearTextPassword&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;clearTextPassword&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;password&apos;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;********&apos;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; password &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getPassword&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;false&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// &quot;password&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Nothing in JavaScript will prevent a script from calling &lt;code class=&quot;language-text&quot;&gt;add(...)&lt;/code&gt; with invalid parameters which will result in a &lt;strong&gt;silent error&lt;/strong&gt; at runtime. This can be entirely avoided &lt;strong&gt;at compile time&lt;/strong&gt; using TypeScript’s type annotations:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// TypeScript&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getPassword&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;clearTextPassword&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;boolean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;clearTextPassword&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;password&apos;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;********&apos;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; password &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getPassword&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;false&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// throws: error TS2345: Argument of type &apos;&quot;false&quot;&apos; is not assignable to parameter of type &apos;boolean&apos;.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;This contrived example demonstrates how we can prevent operations from acting on objects of an unexpected type. Historically, one of the biggest complaints of JavaScript was the difficulty in tracking down issues because of the lack of type checking combined with things like &lt;a href=&quot;https://github.com/getify/You-Dont-Know-JS/blob/master/types%20%26%20grammar/ch4.md#chapter-4-coercion&quot;&gt;type coercion&lt;/a&gt; which may cause undesired results for those who aren’t familiar with JavaScript intricacies.&lt;/p&gt;
&lt;h4&gt;Type-based Language Features&lt;/h4&gt;
&lt;p&gt;In addition to static type analysis, TypeScript also adds the following features to JavaScript:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.typescriptlang.org/docs/handbook/interfaces.html&quot;&gt;Interfaces&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.typescriptlang.org/docs/handbook/generics.html&quot;&gt;Generics&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.typescriptlang.org/docs/handbook/namespaces.html&quot;&gt;Namespaces&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-0.html&quot;&gt;Null checking&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.typescriptlang.org/docs/handbook/classes.html&quot;&gt;Access Modifiers&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;External API Documentation&lt;/h4&gt;
&lt;p&gt;Suppose the above &lt;code class=&quot;language-text&quot;&gt;getPassword(...)&lt;/code&gt; function belonged to an external library. How would I, as a consumer of that library, know the type to pass into the function? There are &lt;a href=&quot;http://usejsdoc.org/&quot;&gt;jsdoc comments&lt;/a&gt; that many IDEs and editors, such as &lt;a href=&quot;https://github.com/Microsoft/TypeScript/wiki/JavaScript-Language-Service-in-Visual-Studio#JsDoc&quot;&gt;VSCode&lt;/a&gt; support. Then there is the library’s own documentation, which are tools like &lt;a href=&quot;https://kapeli.com/dash&quot;&gt;Dash&lt;/a&gt; make more accessible. But none of these provide the kind of experience offered by TypeScript out of the box.&lt;/p&gt;
&lt;p&gt;Consider the &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API&quot;&gt;fetch API&lt;/a&gt; as an example. The following screenshot demonstrates how we can explore the API using the &lt;a href=&quot;https://code.visualstudio.com/docs/editor/editingevolved#_peek&quot;&gt;VSCode Peek Definition&lt;/a&gt; feature. Using these tools we can quickly discover the input parameter types (&lt;code class=&quot;language-text&quot;&gt;RequestInfo&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;RequestInit&lt;/code&gt;) and the return type (&lt;code class=&quot;language-text&quot;&gt;Promise&amp;lt;Response&amp;gt;&lt;/code&gt;). These kind of tools go well beyond what is available through classic JavaScript and jsdocs.&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/intellisense-2694d4a7136938d2c91af2eb13493621-909ad.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 21.084337349397593%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA50lEQVQY001QyXKDMBTje7pM24RAChgwpsTYrJlO2A6kh977Bf11VbQ59KDRPPnpjWTHjSw82aGoRuhmhicMlJ0R6wt24QluqBDKCsfYEgZPB4m75wj3L+IfohsEnFgPyM3EgzOxQJUjpB6RUi/7FbpdYM9X2P4K060o6gW5negZkd28G97olwzh+EkD1a7Izx9QzQJZTZB2QJT38JkqSFsyE6Y1jkmNQDZ4TRtyiyBr/5iaL9g0MnAeGVMNn3j/+obIO3iJgZdVOCQlKxdcJAcFXM5urPkFp995e992XWJPbav7sBP4Ae9gj6YVH45XAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;intellisense&quot;
        title=&quot;&quot;
        src=&quot;/static/intellisense-2694d4a7136938d2c91af2eb13493621-fb8a0.png&quot;
        srcset=&quot;/static/intellisense-2694d4a7136938d2c91af2eb13493621-1a291.png 148w,
/static/intellisense-2694d4a7136938d2c91af2eb13493621-2bc4a.png 295w,
/static/intellisense-2694d4a7136938d2c91af2eb13493621-fb8a0.png 590w,
/static/intellisense-2694d4a7136938d2c91af2eb13493621-526de.png 885w,
/static/intellisense-2694d4a7136938d2c91af2eb13493621-fa2eb.png 1180w,
/static/intellisense-2694d4a7136938d2c91af2eb13493621-909ad.png 1328w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;h3&gt;Misconceptions&lt;/h3&gt;
&lt;p&gt;There are many misconceptions around why someone might choose TypeScript. I’ve cherry-picked a few to discuss here.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ES6 Features&lt;/strong&gt;:
One of the most common reasons for choosing TS is the desire to use ES6 features like modules, classes, arrow functions, &lt;a href=&quot;http://es6-features.org/&quot;&gt;and others&lt;/a&gt;. However, this is not a good reason for choosing TypeScript since the same thing can be achieved using &lt;a href=&quot;https://babeljs.io/&quot;&gt;Babel&lt;/a&gt;. In fact, it is not uncommon to see TypeScript and Babel used in the same application.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;It’s Easier Than JavaScript&lt;/strong&gt;:
For the most part this statement is subjective but there are valid arguments that TS introduces &lt;a href=&quot;https://martinfowler.com/bliki/SyntacticNoise.html&quot;&gt;syntax noise&lt;/a&gt;. The most important thing however, is that TS does not hide JS. It is not an excuse for disregarding JavaScript fundamentals. TS is still a superset of JavaScript and does not provide protection from many of the common complaints against JavaScript which are unrelated to the lack of static type checking (&lt;a href=&quot;https://github.com/getify/You-Dont-Know-JS/blob/master/this%20%26%20object%20prototypes/ch1.md#confusions&quot;&gt;this&lt;/a&gt;, &lt;a href=&quot;https://github.com/getify/You-Dont-Know-JS/tree/master/scope%20%26%20closures&quot;&gt;scopes&lt;/a&gt;, &lt;a href=&quot;https://github.com/getify/You-Dont-Know-JS/blob/master/this%20%26%20object%20prototypes/ch5.md&quot;&gt;prototypes&lt;/a&gt;, etc.). Because of this, developers should still maintain strong JS competence.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Type Correctness == Program Correctness:&lt;/strong&gt;
While this may seem like an obviously incorrect statement, I believe static type checking provides an artificial safety net that developers can take for granted and is worth discussing. If type correctness does not imply program correctness, then what can we do to continually and repeatably ensure our program does what we intend? The best answer I’m aware of is unit testing. So, it begs the question that if we intend to prove our program is correct through unit tests, these tests &lt;em&gt;should&lt;/em&gt; also prevent most type errors.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Static Typing Gives You Tree-Shaking:&lt;/strong&gt;
&lt;a href=&quot;https://webpack.js.org/guides/tree-shaking/&quot;&gt;Tree shaking&lt;/a&gt; refers to dead-code elimination through the use of static constructs like named module &lt;code class=&quot;language-text&quot;&gt;import&lt;/code&gt;/&lt;code class=&quot;language-text&quot;&gt;export&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;const&lt;/code&gt;. TypeScript does not &lt;a href=&quot;https://github.com/Microsoft/TypeScript/issues/8&quot;&gt;currently support&lt;/a&gt; tree-shaking out of the box.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Syntax and Compilation Comparison&lt;/h3&gt;
&lt;p&gt;It is common to hear developers choosing TypeScript because of features like modules and classes. However, it is important to understand these features are also available in JavaScript since ES6 and you can use &lt;a href=&quot;https://babeljs.io/&quot;&gt;Babel&lt;/a&gt; to transpile down to ES5 for greater &lt;a href=&quot;https://caniuse.com/#search=es6&quot;&gt;browser compatibility&lt;/a&gt;. Because of this confusion, here is a quick syntax comparison for some of the more recent EcmaScript features. For each feature, you’ll find the TypeScript version and its compiled ES5 JavaScript along with the dynamic ES6 definition transpiled to ES5 using babel.&lt;/p&gt;
&lt;h4&gt;Classes&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// -- TypeScript -- //&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Article&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; name
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// -- ES5 (using TS compiler) -- //&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; Article &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;/** @class */&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Article&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; name
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; Article
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// -- ES6 -- //&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Article&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; name
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// -- ES5 (using babel) -- //&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;use strict&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;_classCallCheck&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;instance&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Constructor&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;instance &lt;span class=&quot;token keyword&quot;&gt;instanceof&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TypeError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Cannot call a class as a function&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;Article&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Article&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;_classCallCheck&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Article&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; name
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h4&gt;Modules&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// -- TypeScript -- //&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Article&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// -- ES5 (using TS compiler) -- //&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;define&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;require&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;exports&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; exports&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&apos;use strict&apos;&lt;/span&gt;
  Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;defineProperty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;exports&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;__esModule&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; Article &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;/** @class */&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Article&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; Article
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  exports&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Article
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// -- ES6 -- //&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Article&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// -- ES5 (using babel) -- //&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;use strict&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;defineProperty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;exports&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;__esModule&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  value&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;_classCallCheck&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;instance&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Constructor&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;instance &lt;span class=&quot;token keyword&quot;&gt;instanceof&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TypeError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Cannot call a class as a function&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;Article&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Article&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;_classCallCheck&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Article&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

exports&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Article
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h4&gt;Optional Parameters&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// -- TypeScript -- //&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// -- ES5 (using TS compiler) -- //&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// -- ES6 -- //&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// -- ES5 (using babel) -- //&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;use strict&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
    arguments&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; arguments&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; undefined &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; arguments&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h3&gt;When To Choose:&lt;/h3&gt;
&lt;h4&gt;TypeScript&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Working with a New Library or Framework:&lt;/strong&gt;
Let’s suppose you’re taking up React for a new project. You are not familiar with React’s APIs, but since they offer &lt;a href=&quot;https://www.npmjs.com/package/@types/react&quot;&gt;type definitions&lt;/a&gt;, you can get intellisense that will help you navigate and discover the new interfaces.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Prefer Compile Time Type Checking&lt;/strong&gt;: It is entirely possible to perform runtime type verification using vanilla JavaScript. However, this introduces additional runtime overhead that could be avoided by performing compile-time validation&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Large Projects or Multiple Developers:&lt;/strong&gt;
TypeScript makes the most sense when working on large projects or you have several developers working together. Using TypeScript’s interfaces and access modifiers can be invaluable in communicating APIs (which members of a class are available for consumption).&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;JavaScript&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Build Tools Required:&lt;/strong&gt; TypeScript necessitates a build step to produce the final JavaScript to be executed. However, it is becoming increasingly rare to develop JavaScript applications without build tools of any kind.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Small Projects:&lt;/strong&gt; TypeScript may be overkill for small teams or projects with a small code surface area.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Strong Testing Workflow:&lt;/strong&gt; If you have a strong JavaScript team who is already implementing test-driven development, switching to TypeScript may not give you enough to make it worth the associated costs.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Added Dependencies:&lt;/strong&gt; In order to use libraries with TS, you will need their type definitions. Every type definition means an extra npm package. By depending on these extra packages you are accepting the risk that these may go un-maintained or may be incorrect. If you choose not to import the type definitions, you are going to lose much of the TS benefit. Note that the &lt;a href=&quot;https://github.com/DefinitelyTyped/DefinitelyTyped&quot;&gt;DefinitelyTyped&lt;/a&gt; project exists to mitigate these risks. The more popular a library is, the more likely the type definitions are to be maintained for the foreseeable future.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Framework Unsupported:&lt;/strong&gt; If your framework of choice does not support TS, such as EmberJS (although this is planned and is the language of choice for &lt;a href=&quot;https://glimmerjs.com&quot;&gt;Glimmer&lt;/a&gt;), then you may be unable to take advantage of its features.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Other Considerations&lt;/h3&gt;
&lt;p&gt;So you’ve decided that it’s time to introduce a type system to your front-end development workflow. Is TypeScript the only option? The short answer is no. In fact there are two other major tools for type annotations which are worth consideration and have been discussed elsewhere.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://flow.org/&quot;&gt;Facebook’s Flow&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developers.google.com/closure/compiler/&quot;&gt;Google’s Closure&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Resources&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://ttendency.cs.ucl.ac.uk/projects/type_study/documents/type_study.pdf&quot;&gt;To Type or Not to Type: Quantifying Detectable Bugs in JavaScript&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://kangax.github.io/compat-table/es6/&quot;&gt;ES6 Browser Compatibility&lt;/a&gt;
…&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Long Running Tasks In .Net Core With Hangfire]]></title><description><![CDATA[Follow along on  Github Why? Typically, when we think of an ideal RESTful service, it’s one that does very simple CRUD tasks.
However…]]></description><link>https://jaredcnance.github.io//hangfire-tasks-in-dotnet-core/</link><guid isPermaLink="false">https://jaredcnance.github.io//hangfire-tasks-in-dotnet-core/</guid><pubDate>Fri, 19 Aug 2016 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Follow along on &lt;a href=&quot;https://github.com/jaredcnance/hangfire-dot-net-core-example&quot;&gt;Github&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;Why?&lt;/h2&gt;
&lt;p&gt;Typically, when we think of an ideal RESTful service, it’s one that does very simple CRUD tasks.
However, sometimes these tasks aren’t so simple and the reasons are out of our control.
Currently, I am required to build a service that is exposed to a vendor application and am constrained by the rules of that application.
Because of these constraints, creation of resources is a little more complicated. The basic requirements are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Expose an endpoint that the vendor application can use to POST information about a resource, but not the resource itself.&lt;/li&gt;
&lt;li&gt;The application needs to then perform additional tasks to get the information necessary to create the resource&lt;/li&gt;
&lt;li&gt;The vendor client requires a quick HTTP status code response otherwise it will time out.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;The Solution: Asynchronous Background Processing With Hangfire&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;http://hangfire.io/&quot;&gt;Hangfire&lt;/a&gt; seems to be the most popular, well maintained, and well documented background processor for .Net and with their recent &lt;a href=&quot;https://github.com/HangfireIO/Hangfire/pull/604&quot;&gt;upgrade to support .Net Core&lt;/a&gt;, they seem like the best candidate.&lt;/p&gt;
&lt;p&gt;Hangfire is discussed in detail elsewhere and &lt;a href=&quot;http://www.hanselman.com/blog/HowToRunBackgroundTasksInASPNET.aspx&quot;&gt;Scott Hanselman&lt;/a&gt; does an excellent job going over this exact topic.&lt;/p&gt;
&lt;h2&gt;Installation&lt;/h2&gt;
&lt;p&gt;If you are running an app on netcoreapp or netstandard, you should be able to install it just by running &lt;code class=&quot;language-text&quot;&gt;Install-Package Hangfire&lt;/code&gt; in the Package Manager Console or by adding the following to your project.json dependencies and running &lt;code class=&quot;language-text&quot;&gt;dotnet restore&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;quot;Hangfire&amp;quot;: &amp;quot;1.6.2&amp;quot;&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;However, if you are running against net451 (I am because I am waiting on other dependencies to be upgraded), you will need to add the following to your project.json:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;quot;Hangfire.AspNetCore&amp;quot;: &amp;quot;1.6.2&amp;quot;,
&amp;quot;Hangfire.SqlServer&amp;quot;: &amp;quot;1.6.2&amp;quot; // only if you are using SQL Server as your backing data store&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h2&gt;Register the Services&lt;/h2&gt;
&lt;p&gt;In &lt;code class=&quot;language-text&quot;&gt;Startup.cs&lt;/code&gt; add the following to &lt;code class=&quot;language-text&quot;&gt;ConfigureServices(...)&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;services&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddHangfire&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;config &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;UseSqlServerStorage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Configuration&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Data:WorkQueue&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Be sure to add the connections string to your sql server or LocalDb store in your &lt;code class=&quot;language-text&quot;&gt;appsettings.json&lt;/code&gt; file.&lt;/p&gt;
&lt;p&gt;Add the HangfireServer to the request pipeline:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Configure&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;IApplicationBuilder app&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ILoggerFactory loggerFactory&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    loggerFactory&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddConsole&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Configuration&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GetSection&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Logging&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    loggerFactory&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddDebug&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;UseHangfireServer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;UseMvc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h2&gt;Injecting Services&lt;/h2&gt;
&lt;p&gt;Hangfire provides a &lt;a href=&quot;http://docs.hangfire.io/en/latest/background-methods/passing-dependencies.html&quot;&gt;way to inject dependencies&lt;/a&gt; and we can lean on .Net Core’s IServiceProvider as our dependency container.&lt;/p&gt;
&lt;p&gt;So, per the &lt;a href=&quot;http://docs.hangfire.io/en/latest/background-methods/using-ioc-containers.html&quot;&gt;documentation&lt;/a&gt;, we can extend the Hangfire activator like so:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// ServiceProviderActivator.cs&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;using&lt;/span&gt; System&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;using&lt;/span&gt; Hangfire&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ServiceProviderActivator&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; JobActivator
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;readonly&lt;/span&gt; IServiceProvider _serviceProvider&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ServiceProviderActivator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;IServiceProvider serviceProvider&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        _serviceProvider &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; serviceProvider&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ActivateJob&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Type type&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; _serviceProvider&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GetService&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;type&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Now, let’s create the service responsible for executing the long running task:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Services/TodoItemService.cs&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TodoItemService&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; IDisposable
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;readonly&lt;/span&gt; ApplicationDbContext _context&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;TodoItemService&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;IConfigurationRoot configuration&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// create the context here to avoid access to a disposed context&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; dbContextOptionsBuilder &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DbContextOptionsBuilder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        dbContextOptionsBuilder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;UseSqlServer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;configuration&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Data:DefaultConnection&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        _context &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ApplicationDbContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dbContextOptionsBuilder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Options&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;CreateTodoItem&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;TodoItem todoItem&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        Console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Run started&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        _context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;TodoItems&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;todoItem&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        _context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;SaveChanges&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        Thread&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        Console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;WriteLine&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Run complete&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Dispose&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        _context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Dispose&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;Then we can configure it in &lt;code class=&quot;language-text&quot;&gt;Startup.cs&lt;/code&gt; like so:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ConfigureServices&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;IServiceCollection services&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    services&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method function&quot;&gt;AddDbContext&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;ApplicationDbContext&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;options &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    options&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;UseSqlServer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Configuration&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Data:DefaultConnection&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    ServiceLifetime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Transient&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    services&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddHangfire&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;config &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;UseSqlServerStorage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Configuration&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Data:WorkQueue&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// add our service to the ServiceProvider container&lt;/span&gt;
    services&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddSingleton&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TodoItemService&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Configuration&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// add the configuration object&lt;/span&gt;
    services&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddSingleton&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Configuration&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    services&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddMvc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Configure&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;IApplicationBuilder app&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ILoggerFactory loggerFactory&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; IServiceProvider serviceProvider&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    loggerFactory&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddConsole&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Configuration&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GetSection&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Logging&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    loggerFactory&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddDebug&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// add our activator to the GlobalConfiguration&lt;/span&gt;
    GlobalConfiguration&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Configuration&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;UseActivator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ServiceProviderActivator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;serviceProvider&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;UseHangfireServer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;UseMvc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;h2&gt;The Controller&lt;/h2&gt;
&lt;p&gt;The final piece is to create the endpoint. We want to kick off the job and return a &lt;a href=&quot;https://tools.ietf.org/html/rfc2616#section-10.2.3&quot;&gt;202 Accepted&lt;/a&gt; response:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;10.2.3 202 Accepted :
The request has been accepted for processing, but the processing has not been completed.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot;&gt;
      &lt;pre class=&quot;language-csharp&quot;&gt;&lt;code class=&quot;language-csharp&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Controllers/TodoItemsController.cs&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Route&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;api/[controller]&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TodoItemsController&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Controller
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;HttpPost&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; IActionResult &lt;span class=&quot;token function&quot;&gt;Post&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;FromBody&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; TodoItem todoItem&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// start the job&lt;/span&gt;
        BackgroundJob&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token generic-method function&quot;&gt;Enqueue&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;TodoItemService&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;service &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; service&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;CreateTodoItem&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;todoItem&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// return Accepted status code&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StatusCodeResult&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;202&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
      &lt;/div&gt;
&lt;p&gt;And that’s it. The full source code is on &lt;a href=&quot;https://github.com/jaredcnance/hangfire-dot-net-core-example&quot;&gt;Github&lt;/a&gt; If you run the app and send a POST to &lt;code class=&quot;language-text&quot;&gt;http://localhost:5000/api/todoitems&lt;/code&gt; you can see the job being created and executed.&lt;/p&gt;</content:encoded></item></channel></rss>